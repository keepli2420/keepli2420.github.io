"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[9407],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>u});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function _(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o=r.createContext({}),l=function(e){var n=r.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):_(_({},n),e)),t},d=function(e){var n=l(e.components);return r.createElement(o.Provider,{value:n},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,s=e.originalType,o=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),m=l(t),p=a,u=m["".concat(o,".").concat(p)]||m[p]||c[p]||s;return t?r.createElement(u,_(_({ref:n},d),{},{components:t})):r.createElement(u,_({ref:n},d))}));function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=t.length,_=new Array(s);_[0]=p;var i={};for(var o in n)hasOwnProperty.call(n,o)&&(i[o]=n[o]);i.originalType=e,i[m]="string"==typeof e?e:a,_[1]=i;for(var l=2;l<s;l++)_[l]=t[l];return r.createElement.apply(null,_)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},7143:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>_,default:()=>m,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var r=t(7462),a=(t(7294),t(3905));const s={},_="Mysql",i={unversionedId:"back/db/mysqsl/MySql",id:"back/db/mysqsl/MySql",title:"Mysql",description:"\u6279\u91cf\u6dfb\u52a0\uff0c UUID\uff08\uff09\uff0cExists\uff0cGroupBy",source:"@site/docs/back/db/mysqsl/MySql.md",sourceDirName:"back/db/mysqsl",slug:"/back/db/mysqsl/MySql",permalink:"/docs/back/db/mysqsl/MySql",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/back/db/mysqsl/MySql.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u56de\u987e",permalink:"/docs/back/ReCode"},next:{title:"spring",permalink:"/docs/back/spring/"}},o={},l=[{value:"\u6279\u91cf\u6dfb\u52a0\uff0c UUID\uff08\uff09\uff0cExists\uff0cGroupBy",id:"\u6279\u91cf\u6dfb\u52a0-uuidexistsgroupby",level:2},{value:"\u6279\u91cf\u6dfb\u52a0\uff0c\u81ea\u5b9a\u4e49\u5c40\u90e8\u53d8\u91cf",id:"\u6279\u91cf\u6dfb\u52a0\u81ea\u5b9a\u4e49\u5c40\u90e8\u53d8\u91cf",level:2},{value:"floor\u3001datediff \u3001case...then...end",id:"floordatediff-casethenend",level:2},{value:"GroupBy \u975e\u805a\u5408\u5b57\u6bb5\u5904\u7406",id:"groupby-\u975e\u805a\u5408\u5b57\u6bb5\u5904\u7406",level:2},{value:"union",id:"union",level:2},{value:"foreach \u6279\u91cf\u66f4\u65b0",id:"foreach-\u6279\u91cf\u66f4\u65b0",level:2},{value:"Group_Concat\u3001With as\u3001Locate",id:"group_concatwith-aslocate",level:2},{value:"ifnull \u81ea\u5173\u8054\u589e\u52a0\u67e5\u8be2\u5b57\u6bb5",id:"ifnull-\u81ea\u5173\u8054\u589e\u52a0\u67e5\u8be2\u5b57\u6bb5",level:2},{value:"\u9012\u5f52\u67e5\u8be2",id:"\u9012\u5f52\u67e5\u8be2",level:2},{value:"\u83b7\u53d6\u96c6\u5408\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\uff0cquerywrapper.last",id:"\u83b7\u53d6\u96c6\u5408\u4e2d\u7684\u6700\u540e\u4e00\u4e2aquerywrapperlast",level:2}],d={toc:l};function m(e){let{components:n,...s}=e;return(0,a.kt)("wrapper",(0,r.Z)({},d,s,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"mysql"},"Mysql"),(0,a.kt)("h2",{id:"\u6279\u91cf\u6dfb\u52a0-uuidexistsgroupby"},"\u6279\u91cf\u6dfb\u52a0\uff0c UUID\uff08\uff09\uff0cExists\uff0cGroupBy"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-mysql"},"INSERT INTO assess_info_ability\n(id, assess_info_type_id, ability_code, stage_level, type_score, start_time, end_time)\nSELECT\n    REPLACE(UUID(),'-','') id,\n    ait.id assess_info_type_id,\n    sc.ability_code,\n    ait.stage_level,\n    null type_score,\n    SYSDATE() start_time,\n    null end_time\nFROM assess_info_type ait,\n    (SELECT type_code, ability_code\n        FROM sys_code\n        WHERE type_code = '01'\n        AND del_flag = '0'\n        GROUP BY type_code,ability_code) sc\nWHERE ait.type_code  = sc.type_code \n    AND ait.id = '00000865e3ad4f859ec51244d42010de'\n    AND EXISTS(\n        SELECT aqb.id\n        FROM  sys_code s,\n            assess_question_bank aqb \n        WHERE ability_code = sc.ability_code\n            AND aqb.del_flag = '0'\n            AND aqb.skill_code = s.skill_code\n            AND aqb.stage_level = ait.stage_level\n    )\n    ORDER BY sc.ability_code\n")),(0,a.kt)("h2",{id:"\u6279\u91cf\u6dfb\u52a0\u81ea\u5b9a\u4e49\u5c40\u90e8\u53d8\u91cf"},"\u6279\u91cf\u6dfb\u52a0\uff0c\u81ea\u5b9a\u4e49\u5c40\u90e8\u53d8\u91cf"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-mysql"},'insert into assess_pre_result\n        (id, pre_paper_id, pre_question_id, score, sort, create_time, answer_time)\n      select replace(uuid(),"-","") id,\n              #{prePaperId} pre_paper_id,\n              id pre_question_id,\n              null score,\n              @rowNum:=@rowNum + 1 as sort,\n              #{createTime} create_time,\n              null end_time\n        from assess_pre_question_bank,\n             (select @rownum := 0) r\n       where type_code = #{typeCode}\n              and appliance_age_level = #{level}\n              and del_flag = \'0\'\n    order by cast(id as unsigned)\n    \n    \n    \n    \n    insert into assess_info_ability_detail\n        (id, assess_info_ability_id, question_id, score, user_remark, start_time, end_time, sort)\n        select t.*, @rowNum:=@rowNum + 1 as sort\n          from (select  replace(uuid(),"-","") id,\n                         aia.id assess_info_ability_id,\n                         aqb.id question_id,\n                         null score,\n                         null user_remark,\n                         SYSDATE() start_time,\n                         null end_time\n                  from  assess_info_ability aia,\n                         (select ability_code, skill_code\n                            from sys_code\n                           where del_flag = \'0\'\n                        group by ability_code, skill_code) sc,\n                         assess_question_bank aqb\n                 where  sc.ability_code = aia.ability_code\n                         and aqb.skill_code = sc.skill_code\n                         and aia.assess_info_type_id = #{assessInfoTypeId}\n                         and aqb.stage_level = aia.stage_level\n                         and aia.end_time is null\n                         and aia.type_score is null\n                         and aqb.del_flag = \'0\'\n              order by sc.ability_code, aqb.id) t,\n               (select @rownum := 0) r\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u521d\u59cb\u8d4b\u503c\uff1a"),(0,a.kt)("p",{parentName:"blockquote"},"set @num=1\nset @num:=1 "),(0,a.kt)("p",{parentName:"blockquote"},"select @num:=1\nselect @num:=\u5b57\u6bb5\u540d from \u8868\u540d where \u6761\u4ef6"),(0,a.kt)("p",{parentName:"blockquote"},"\u4f7f\u7528set\u65f6\u53ef\u4ee5\u7528\u201c=\u201d\u6216\u201c:=\u201d\uff0c\u4f46\u662f\u4f7f\u7528select\u65f6\u5fc5\u987b\u7528\u201c:=\u8d4b\u503c\u201d"),(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre",className:"language-dart"},"\u6839\u636e\u5b66\u751f\u7684\u5e74\u5e74\u9f84\u8fdb\u884c\u6392\u5e8f\uff0c\u76f8\u540c\u5e74\u9f84\u7684\u5b66\u751f\u4e3a\u4e00\u7ec4\uff0c\u7ec4\u5185\u7f16\u53f7\u4f9d\u6b21\u4e3a1\uff0c2\uff0c3...\n\u5b9e\u73b0\uff1a\u4e00\u4e2a\u5b57\u6bb5\u5185\u90e8\u7684\u6392\u5e8f\u3002\nMySQL\u4e2drow_number\u7684\u5b9e\u73b0\n\u901a\u5e38\uff0c\u7528group by \u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u5b57\u6bb5\u7684\u805a\u5408\uff0c\u518d\u7ed3\u5408order by\u8fdb\u884c\u6392\u5e8f\u3002\u4f46\u662f\u5728\u4e00\u4e2a\u5b57\u6bb5\u5185\u90e8\u4e0d\u540c\u7684'\u503c'\u518d\u805a\u5408\u5e76\u6392\u5e8f\uff0c\u5c31\u4e0d\u662fgroup by\u80fd\u591f\u505a\u5230\u7684\u4e86\u3002\n\u6b64\u5904\u53ef\u4ee5\u4f7f\u7528\u5c40\u90e8\u53d8\u91cf\u5b9e\u73b0\u81ea\u589e\uff0c\u7ed9\u5b57\u6bb5\u5185\u4e0d\u540cvalue \u4f7f\u7528case...when...\u8fdb\u884c\u6761\u4ef6\u5224\u65ad\u540e\u6253\u4e0a\u6807\u7b7e\uff0c\u4e5f\u5c31\u5b9e\u73b0\u4e86\u6392\u5e8f\u529f\u80fd\u3002\n  \n  \nset @row_num:=0,@customer_num:=0\nselect \n@row_num:=\n    case when @customer_num=(year(now())-year(stu.sage)) then @row_num+1 else 1 end as num,\n        @customer_num := (year(now())-year(stu.sage)) as age_n,\nstu.sid,stu.sname\nfrom student as stu\norder by sid\n"))),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"1655357871797",src:t(9090).Z,width:"312",height:"169"})),(0,a.kt)("h2",{id:"floordatediff-casethenend"},"floor\u3001datediff \u3001case...then...end"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-mysql"},"select aiad.question_id,\n         floor((DATEDIFF(ait.start_time, s.birthday) / (30 * 12))) +\n         case floor((DATEDIFF(ait.start_time, s.birthday) / 30)) % 12\n                             when 1 then 0.25\n                                                                    when 2 then 0.25\n                                                                    when 3 then 0.25\n                                                                    when 4 then 0.5\n                                                                    when 5 then 0.5\n                                                                    when 6 then 0.5\n                                                                    when 7 then 0.75\n                                                                    when 8 then 0.75\n                                                                    when 9 then 0.75\n                                                                    when 10 then 1\n                                                                    when 11 then 1\n                                                                    else 0\n                                                         end  assess_age\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"datediff\uff1a\u8fd4\u56de\u4e24\u4e2a\u65e5\u671f\u76f8\u5dee\u7684day")),(0,a.kt)("h2",{id:"groupby-\u975e\u805a\u5408\u5b57\u6bb5\u5904\u7406"},"GroupBy \u975e\u805a\u5408\u5b57\u6bb5\u5904\u7406"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-mysql"},"select pr.id resultId,\n              pr.pre_paper_id prePaperId,\n              pr.pre_question_id preQuestionId,\n              pqb.type_code typeCode,\n              sc.type_name typeName,\n              pqb.description description,\n              pqb.video_help videoHelp,\n              pqb.operation,\n              pqb.standard\n        from assess_pre_result pr,\n              assess_pre_question_bank pqb,\n              (select type_code, max(type_name) type_name from sys_code group by type_code) sc\n       where pqb.id = pr.pre_question_id\n              and sc.type_code = pqb.type_code\n              and pr.pre_paper_id = #{prePaperId}\n              and pr.answer_time is null\n       order by sort;\n")),(0,a.kt)("h2",{id:"union"},"union"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-mysql"},"select app.id, '0' assess_type, app.type_code, '' stage_level, '' type_score, app.create_time start_time, app.end_time\n                       from assess_pre_paper app\n                      where app.student_id = '3060978c5ab4458fa8f6a450360d9939'\n                             and app.end_time is not null\n                     union\nselect ait.id, '1'  assess_type, ait.type_code, ait.stage_level, ait.type_score, ait.start_time, ait.end_time\n                        from assess_info ai,\n                              assess_info_type ait\n                       where ait.assess_info_id = ai.id\n                              and ai.student_id = '3060978c5ab4458fa8f6a450360d9939'\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u53ef\u4ee5\u4f7f\u4e24\u5f20\u6beb\u4e0d\u76f8\u2f32\u7684\u8868\u7684\u67e5\u8be2\u7ed3\u679c\u62fc\u63a5\u5728\u2f00\u8d77\u8f93\u51fa\uff0c\u524d\u63d0\u662f\u4e24\u4e2a\u67e5\u8be2\u7684\u5217\u6570\u8981\u76f8\u540c"),(0,a.kt)("p",{parentName:"blockquote"},"UNION \u53ea\u4f1a\u9009\u53d6\u4e0d\u540c\u7684\u503c\u3002\u8bf7\u4f7f\u7528 UNION ALL \u6765\u9009\u53d6\u91cd\u590d\u7684\u503c\uff01")),(0,a.kt)("h2",{id:"foreach-\u6279\u91cf\u66f4\u65b0"},"foreach \u6279\u91cf\u66f4\u65b0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-mysql"},'<foreach collection="list" item="preResult" index="index" open="" close="" separator=";">\n    update assess_pre_result\n        set score = #{preResult.score},\n            answer_time = #{preResult.answerTime}\n    where id  = #{preResult.id}\n</foreach>\n')),(0,a.kt)("h2",{id:"group_concatwith-aslocate"},"Group_Concat\u3001With as\u3001Locate"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-mysql"},"WITH t AS (\n  select ar.student_id, art.type_code,\n  GROUP_CONCAT(art.stage_level order by ar.start_time desc) level_list,\n  GROUP_CONCAT(art.type_score order by ar.start_time desc) score_list,\n  GROUP_CONCAT(art.ranking_num order by ar.start_time desc) ranking_num_list,\n  GROUP_CONCAT(art.ranking_count order by ar.start_time desc) ranking_count_list,\n  GROUP_CONCAT(art.refer_age order by ar.start_time desc) refer_age_list,\n\n  -- \u5f53\u524d\u8bc4\u4f30 level, score, ranking_num, ranking_count\n  -- current_level\n  1 current_level_index,\n  IF(LOCATE(',', GROUP_CONCAT(art.stage_level order by ar.start_time desc)) = 0,\n     LENGTH(GROUP_CONCAT(art.stage_level order by ar.start_time desc)),\n     LOCATE(',', GROUP_CONCAT(art.stage_level order by ar.start_time desc)) - 1) current_level_length,\n\n  -- current_score\n  1 current_score_index,\n  IF(LOCATE(',', GROUP_CONCAT(art.type_score order by ar.start_time desc)) = 0,\n     LENGTH(GROUP_CONCAT(art.type_score order by ar.start_time desc)),\n     LOCATE(',', GROUP_CONCAT(art.type_score order by ar.start_time desc)) - 1) current_score_length,\n\n  -- current_ranking_num\n  1 current_ranking_num_index,\n  IF(LOCATE(',', GROUP_CONCAT(art.ranking_num order by ar.start_time desc)) = 0,\n     LENGTH(GROUP_CONCAT(art.ranking_num order by ar.start_time desc)),\n     LOCATE(',', GROUP_CONCAT(art.ranking_num order by ar.start_time desc)) - 1) current_ranking_num_length,\n\n  -- current_ranking_count\n  1 current_ranking_count_index,\n  IF(LOCATE(',', GROUP_CONCAT(art.ranking_count order by ar.start_time desc)) = 0,\n     LENGTH(GROUP_CONCAT(art.ranking_count order by ar.start_time desc)),\n     LOCATE(',', GROUP_CONCAT(art.ranking_count order by ar.start_time desc)) - 1) current_ranking_count_length,\n\n  -- current_refer_age\n  1 current_refer_age_index,\n  IF(LOCATE(',', GROUP_CONCAT(art.refer_age order by ar.start_time desc)) = 0,\n     LENGTH(GROUP_CONCAT(art.refer_age order by ar.start_time desc) ),\n     LOCATE(',', GROUP_CONCAT(art.refer_age order by ar.start_time desc)) - 1) current_refer_age_length,\n\n  -- \u4e0a\u4e00\u6b21\u8bc4\u4f30 level, score, ranking_num, ranking_count\n  -- last_level\n  IF(LOCATE(',', GROUP_CONCAT(art.stage_level order by ar.start_time desc)) = 0, 0,\n     LOCATE(',', GROUP_CONCAT(art.stage_level order by ar.start_time desc)) + 1) last_level_index,\n\n  IF(LOCATE(',', GROUP_CONCAT(art.stage_level order by ar.start_time desc)) = 0, 0,\n     IF(LOCATE(',', GROUP_CONCAT(art.stage_level order by ar.start_time desc), LOCATE(',', GROUP_CONCAT(art.stage_level order by ar.start_time desc)) + 1) = 0,\n        LENGTH(GROUP_CONCAT(art.stage_level order by ar.start_time desc)) - LOCATE(',', GROUP_CONCAT(art.stage_level order by ar.start_time desc)),\n        LOCATE(',', GROUP_CONCAT(art.stage_level order by ar.start_time desc),\n               LOCATE(',', GROUP_CONCAT(art.stage_level order by ar.start_time desc))+1) - (LOCATE(',', GROUP_CONCAT(art.stage_level order by ar.start_time desc))+1))\n    ) last_level_length,\n\n  -- last_score\n  LOCATE(',', GROUP_CONCAT(art.type_score order by ar.start_time desc)) + 1 last_score_index,\n  IF(LOCATE(',', GROUP_CONCAT(art.type_score order by ar.start_time desc)) = 0, 0,\n     IF(LOCATE(',', GROUP_CONCAT(art.type_score order by ar.start_time desc), LOCATE(',', GROUP_CONCAT(art.type_score order by ar.start_time desc)) + 1) = 0,\n        LENGTH(GROUP_CONCAT(art.type_score order by ar.start_time desc)) - LOCATE(',', GROUP_CONCAT(art.type_score order by ar.start_time desc)),\n        LOCATE(',', GROUP_CONCAT(art.type_score order by ar.start_time desc),\n               LOCATE(',', GROUP_CONCAT(art.type_score order by ar.start_time desc))+1) - (LOCATE(',', GROUP_CONCAT(art.type_score order by ar.start_time desc))+1))\n    ) last_score_length,\n\n  -- last_ranking_num\n  LOCATE(',', GROUP_CONCAT(art.ranking_num order by ar.start_time desc)) + 1 last_ranking_num_index,\n  IF(LOCATE(',', GROUP_CONCAT(art.ranking_num order by ar.start_time desc)) = 0, 0,\n     IF(LOCATE(',', GROUP_CONCAT(art.ranking_num order by ar.start_time desc), LOCATE(',', GROUP_CONCAT(art.ranking_num order by ar.start_time desc)) + 1) = 0,\n        LENGTH(GROUP_CONCAT(art.ranking_num order by ar.start_time desc)) - LOCATE(',', GROUP_CONCAT(art.ranking_num order by ar.start_time desc)),\n        LOCATE(',', GROUP_CONCAT(art.ranking_num order by ar.start_time desc),\n               LOCATE(',', GROUP_CONCAT(art.ranking_num order by ar.start_time desc))+1) - (LOCATE(',', GROUP_CONCAT(art.ranking_num order by ar.start_time desc))+1))\n    ) last_ranking_num_length,\n\n  -- last_ranking_count\n  LOCATE(',', GROUP_CONCAT(art.ranking_count order by ar.start_time desc)) + 1 last_ranking_count_index,\n  IF(LOCATE(',', GROUP_CONCAT(art.ranking_count order by ar.start_time desc)) = 0, 0,\n     IF(LOCATE(',', GROUP_CONCAT(art.ranking_count order by ar.start_time desc), LOCATE(',', GROUP_CONCAT(art.ranking_count order by ar.start_time desc)) + 1) = 0,\n        LENGTH(GROUP_CONCAT(art.ranking_count order by ar.start_time desc)) - LOCATE(',', GROUP_CONCAT(art.ranking_count order by ar.start_time desc)),\n        LOCATE(',', GROUP_CONCAT(art.ranking_count order by ar.start_time desc),\n               LOCATE(',', GROUP_CONCAT(art.ranking_count order by ar.start_time desc))+1) - (LOCATE(',', GROUP_CONCAT(art.ranking_count order by ar.start_time desc))+1))\n    ) last_ranking_count_length,\n\n  -- last_refer_age\n  LOCATE(',', GROUP_CONCAT(art.refer_age order by ar.start_time desc)) + 1 last_refer_age_index,\n  IF(LOCATE(',', GROUP_CONCAT(art.refer_age order by ar.start_time desc)) = 0, 0,\n     IF(LOCATE(',', GROUP_CONCAT(art.refer_age order by ar.start_time desc), LOCATE(',', GROUP_CONCAT(art.refer_age order by ar.start_time desc)) + 1) = 0,\n        LENGTH(GROUP_CONCAT(art.refer_age order by ar.start_time desc)) - LOCATE(',', GROUP_CONCAT(art.refer_age order by ar.start_time desc)),\n        LOCATE(',', GROUP_CONCAT(art.refer_age order by ar.start_time desc),\n               LOCATE(',', GROUP_CONCAT(art.refer_age order by ar.start_time desc))+1) - (LOCATE(',', GROUP_CONCAT(art.refer_age order by ar.start_time desc))+1))\n    ) last_refer_age_length\n\n  from assess_report ar,\n  assess_report_type art\n  where art.report_id = ar.id\n  and art.type_code = '01'\n  group by student_id, art.type_code\n)\n\n\n\nselect t.student_id, t.type_code,\n                SUBSTR(t.level_list, t.current_level_index, t.current_level_length) current_level,\n                SUBSTR(t.score_list, t.current_score_index, t.current_score_length) current_score,\n                IFNULL(SUBSTR(t.ranking_num_list, t.current_ranking_num_index, t.current_ranking_num_length),0) current_ranking_num,\n                IFNULL(SUBSTR(t.ranking_count_list, t.current_ranking_count_index, t.current_ranking_count_length),1) current_ranking_count,\n                SUBSTR(t.refer_age_list, t.current_refer_age_index, t.current_refer_age_length) current_refer_age,\n                IF(t.last_level_index = 0, null,\n                   IF(t.last_level_length <= 0,\n                      SUBSTR(t.level_list, t.last_level_index),\n                      SUBSTR(t.level_list, t.last_level_index, t.last_level_length))) last_level,\n                IF(t.last_level_index = 0, null,\n                   IF(t.last_score_length <= 0,\n                      SUBSTR(t.score_list, t.last_score_index),\n                      SUBSTR(t.score_list, t.last_score_index, t.last_score_length))) last_score,\n                IFNULL(IF(t.last_level_index = 0, null,\n                          IF(t.last_ranking_num_length <= 0,\n                             SUBSTR(t.ranking_num_list, t.last_ranking_num_index),\n                             SUBSTR(t.ranking_num_list, t.last_ranking_num_index, t.last_ranking_num_length))),0) last_ranking_num,\n                IFNULL(IF(t.last_level_index = 0, null,\n                          IF(t.last_ranking_count_length <= 0,\n                             SUBSTR(t.ranking_count_list, t.last_ranking_count_index),\n                             SUBSTR(t.ranking_count_list, t.last_ranking_count_index, t.last_ranking_count_length))),1) last_ranking_count,\n                IF(t.last_level_index = 0, null,\n                   IF(t.last_refer_age_length <= 0,\n                      SUBSTR(t.refer_age_list, t.last_refer_age_index),\n                      SUBSTR(t.refer_age_list, t.last_refer_age_index, t.last_refer_age_length))) last_refer_age\n          from t\n\n\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"group_concat \u51fd\u6570\u7684\u4f5c\u7528\uff1a\u51fd\u6570\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\u7ed3\u679c\uff0c\u8be5\u7ed3\u679c\u7531\u5206\u7ec4\u4e2d\u7684\u503c\u8fde\u63a5\u7ec4\u5408\u800c\u6210\u3002"),(0,a.kt)("p",{parentName:"blockquote"},"LOCATE(substr,str)\u8fd4\u56de\u5b57\u7b26\u4e32substr\u4e2d\u7b2c\u4e00\u6b21\u51fa\u73b0\u5b50\u5b57\u7b26\u4e32\u7684\u4f4d\u7f6e str"),(0,a.kt)("p",{parentName:"blockquote"},"LOCATE(substr,str,pos)\u8fd4\u56de\u5b57\u7b26\u4e32substr\u4e2d\u7b2c\u4e00\u4e2a\u51fa\u73b0\u5b50 \u5b57\u7b26\u4e32\u7684 str\u4f4d\u7f6e\uff0c\u4ece\u4f4d\u7f6e\u5f00\u59cb pos\u30020 \u5982\u679csubstr\u4e0d\u5728\uff0c\u5219 \u8fd4\u56destr\u3002\u8fd4\u56de NULL\u5982\u679csubstr \u6216\u8005str\u662fNULL")),(0,a.kt)("h2",{id:"ifnull-\u81ea\u5173\u8054\u589e\u52a0\u67e5\u8be2\u5b57\u6bb5"},"ifnull \u81ea\u5173\u8054\u589e\u52a0\u67e5\u8be2\u5b57\u6bb5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-mysql"}," \nSELECT\n    id assess_info_id,\n    stu_id student_id,\n    stage_level,\n    total_score,\n    start_time,\n    end_time,\n    assess_count \nFROM\n    (\n    SELECT\n        ifnull( count( student_id ), 0 ) assess_count,\n        ifnull(student_id,'3060978c5ab4458fa8f6a450360d9939') stu_id\n    FROM\n            assess_info \n        WHERE\n            student_id = '3060978c5ab4458fa8f6a450360d9939') ac\n            LEFT JOIN assess_info ON student_id = stu_id \n        ORDER BY\n        start_time DESC \n    LIMIT 1\n    \n    \n\n")),(0,a.kt)("h2",{id:"\u9012\u5f52\u67e5\u8be2"},"\u9012\u5f52\u67e5\u8be2"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">\n\n<mapper namespace="com.also.modules.sys.dao.SysMenuOperationDao">\n\n   \x3c!-- \u53ef\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\uff0c\u662f\u5426\u8981\u4f7f\u7528 --\x3e\n    <resultMap type="com.also.modules.sys.entity.SysMenuOperationEntity" id="SysMenuOperationMap">\n        <result property="id" column="id"/>\n        <result property="menuId" column="menu_id"/>\n        <result property="remark" column="remark"/>\n        <result property="action" column="action"/>\n        <result property="apiPath" column="api_path"/>\n        <result property="name" column="name"/>\n    </resultMap>\n    <resultMap type="com.also.modules.sys.vo.MenuAndOperationVo" id="menuAndOperationMap">\n        <result property="menuId" column="r_id"/>\n        <result property="name" column="r_name"/>\n        <result property="parentId" column="r_parent_id"/>\n        <result property="key" column="r_name"/>\n        <association property="operationEntities" select="child" javaType="com.also.modules.sys.vo.MenuAndOperationVo" column="childId">\n            <result property="menuId" column="menu_id"/>\n\n        </association>\n        <association property="children" select="child" javaType="com.also.modules.sys.vo.MenuAndOperationVo" column="childId">\n        </association>\n    </resultMap>\n\n    <resultMap type="com.also.modules.sys.vo.MenuAndOperationVo" id="menuAndOperationMapChild">\n        <result property="menuId" column="r_id"/>\n        <result property="name" column="r_name"/>\n        <result property="parentId" column="r_parent_id"/>\n        <result property="key" column="r_name"/>\n        <association property="children" resultMap="levelTwoOfMenu"/>\n        <association property="operationEntities" select="child">\n        </association>\n    </resultMap>\n\n    <resultMap type="com.also.modules.sys.vo.MenuAndOperationVo" id="levelTwoOfMenu">\n        <result property="menuId" column="rr_id"/>\n        <result property="name" column="rr_name"/>\n        <result property="parentId" column="rr_parent_id"/>\n        <result property="key" column="rr_name"/>\n        <association property="children" resultMap="levelThreeOfMenu"/>\n        <association property="operationEntities" resultMap="SysMenuOperationMap" javaType="list" columnPrefix="rr_mo_"/>\n    </resultMap>\n\n    <resultMap type="com.also.modules.sys.vo.MenuAndOperationVo" id="levelThreeOfMenu">\n        <result property="menuId" column="rrr_id"/>\n        <result property="name" column="rrr_name"/>\n        <result property="parentId" column="rrr_parent_id"/>\n        <result property="key" column="rrr_name"/>\n        <association property="operationEntities" resultMap="SysMenuOperationMap" javaType="list" columnPrefix="rrr_mo_"/>\n    </resultMap>\n\n    <select id="child" parameterType="string" resultMap="menuAndOperationMapChild">\n        SELECT\n            m_root.id           r_id,\n            m_root.`name`       r_name,\n            m_root.parent_id    r_parent_id,\n            m.id                rr_id,\n            m.`name`            rr_name,\n            m.parent_id         rr_parent_id\n        FROM\n            m_sys_menu m\n            LEFT JOIN m_sys_menu_operation mo ON m.id = mo.menu_id\n        WHERE\n            m.parent_id = #{childId} and m.`show` = \'1\'\n    </select>\n\n    <select id="listAllMenuAndOperations" resultMap="menuAndOperationMap">\n        SELECT\n            m_root.id           r_id,\n            m_root.`name`       r_name,\n            m_root.parent_id    r_parent_id,\n            mo.id               rr_mo_id,\n            mo.menu_id          rr_mo_menu_id,\n            mo.action           rr_mo_action,\n            mo.remark           rr_mo_remark,\n            mo.api_path         rr_mo_api_path,\n            m.`name`            rr_mo_name\n        FROM\n            m_sys_menu m\n            LEFT JOIN m_sys_menu_operation mo ON mo.menu_id = m.id\n        WHERE\n            m.`show` = \'1\'\n          AND m.parent_id = 0\n    </select>\n    <select id="getRolesApiPathMapping" resultType="com.also.modules.sys.entity.UriRoleEntity">\n        SELECT\n            mo.api_path `uri`,\n            IFNULL( r.role, \'ROLE_UNDEFINED\' ) `role`\n        FROM\n            m_sys_menu_operation mo\n            LEFT JOIN m_sys_role_permission rp ON mo.id = rp.operation_id\n            LEFT JOIN m_sys_role r ON r.id = rp.role_id\n        WHERE\n            mo.api_path IS NOT NULL\n    </select>\n\n    <select id="getMenuOperationList" resultMap="menuAndOperationMap">\n        SELECT\n            mo.*,\n            m.id m_id,\n            m.`name` m_name\n        FROM\n            m_sys_menu_operation mo\n            LEFT JOIN m_sys_menu m ON mo.menu_id = m.id\n        <where>\n            <if test="item.name != null and item.name != \'\'">\n                m.name LIKE CONCAT(#{item.name},\'%\')\n            </if>\n        </where>\n\n    </select>\n    <select id="listByRoleIds" resultType="com.also.modules.sys.entity.SysMenuOperationEntity">\n        SELECT mo.*\n        FROM\n            m_sys_menu_operation mo\n            LEFT JOIN m_sys_role_permission rp ON rp.operation_id = mo.id\n        WHERE rp.role_id IN\n        <foreach collection="item" separator="," open="(" close=")" item="roleId">\n            #{roleId}\n        </foreach>\n        GROUP BY mo.id\n    </select>\n    <select id="listMenuAndOperationsByRole" resultMap="menuAndOperationMap">\n        SELECT\n            m.id m_id,\n            m.`name` m_name,\n            mo.*\n        FROM\n            m_sys_role r\n            LEFT JOIN m_sys_role_permission rp ON r.id = rp.role_id\n            LEFT JOIN m_sys_menu_operation mo ON rp.operation_id = mo.id\n            LEFT JOIN m_sys_menu m ON mo.menu_id = m.id\n        WHERE\n            r.id = #{roleId}\n          AND m.parent_id != \'0\'\n          AND m.`show` = \'1\'\n    </select>\n</mapper>\n')),(0,a.kt)("h1",{id:"mybatisplus"},"MybatisPlus"),(0,a.kt)("h2",{id:"\u83b7\u53d6\u96c6\u5408\u4e2d\u7684\u6700\u540e\u4e00\u4e2aquerywrapperlast"},"\u83b7\u53d6\u96c6\u5408\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\uff0cquerywrapper.last"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java"},'AssessInfoEntity assessInfoEntity = assessInfoDao.selectOne(\n                new QueryWrapper<AssessInfoEntity>().eq("student_id", studentId)\n                        .and(wrapper -> wrapper.isNull("end_time"))\n                        .orderByDesc("start_time")\n                        .last("limit 1"));\n')),(0,a.kt)("p",null,"SELECT\nm_root.id r_id,\nm_root.",(0,a.kt)("inlineCode",{parentName:"p"},"name")," r_name,\nm_root.parent_id r_parent_id,\nnull rr_id,\nnull rr_name,\nnull rr_parent_id,\nm.id m_id,\nm.",(0,a.kt)("inlineCode",{parentName:"p"},"name")," m_name,\nm.parent_id m_parent_id,\nmo.*\nFROM\nm_sys_menu m\nLEFT JOIN m_sys_menu_operation mo ON mo.menu_id = m.id\nLEFT JOIN m_sys_menu m_root ON m.parent_id = m_root.id\nWHERE\nm.",(0,a.kt)("inlineCode",{parentName:"p"},"show")," = '1'\nAND LENGTH( m.id ) = 3\nAND mo.id IS NOT NULL"),(0,a.kt)("p",null,"UNION\nSELECT\nm_root.id r_id,\nm_root.",(0,a.kt)("inlineCode",{parentName:"p"},"name")," r_name,\nm_root.parent_id r_parent_id,\nm_rr.id rr_id,\nm_rr.",(0,a.kt)("inlineCode",{parentName:"p"},"name")," rr_name,\nm_rr.parent_id rr_parent_id,\nm.id m_id,\nm.",(0,a.kt)("inlineCode",{parentName:"p"},"name")," m_name,\nm.parent_id m_parent_id,\nmo.*\nFROM\nm_sys_menu m\nLEFT JOIN m_sys_menu_operation mo ON mo.menu_id = m.id\nLEFT JOIN m_sys_menu m_rr ON m.parent_id = m_rr.id\nLEFT JOIN m_sys_menu m_root ON m_rr.parent_id = m_root.id\nWHERE\nm.",(0,a.kt)("inlineCode",{parentName:"p"},"show")," = '1'\nAND LENGTH( m.id ) = 5\nAND mo.id IS NOT NULL"))}m.isMDXComponent=!0},9090:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/1655357871797-eaec47138df8fdd77361ce5164719713.png"}}]);