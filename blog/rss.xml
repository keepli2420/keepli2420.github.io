<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>My Site Blog</title>
        <link>https://keepli2420.github.io/blog</link>
        <description>My Site Blog</description>
        <lastBuildDate>Tue, 21 Mar 2023 00:18:07 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>zh</language>
        <item>
            <title><![CDATA[JVM学习]]></title>
            <link>https://keepli2420.github.io/blog/JVM</link>
            <guid>/JVM</guid>
            <pubDate>Tue, 21 Mar 2023 00:18:07 GMT</pubDate>
            <description><![CDATA[基本概念：JVM包括一套字节码指令集、一组寄存器、一个栈、一个垃圾回收，堆和一个存储方法域]]></description>
            <content:encoded><![CDATA[<blockquote><p>基本概念：JVM包括一套字节码指令集、一组寄存器、一个栈、一个垃圾回收，堆和一个存储方法域</p><p>运行过程：将JAVA源文件通过编译器编译成字节码文件；将字节码文件通过JVM转化成机器码。
JVM虚拟机就是负责将字节码文件转换成机器码，不同平台版本的JVM会转换成不同的机器码，所以就实现了一次编译，到处运行的目的</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-线程">1.1 线程<a class="hash-link" href="#11-线程" title="标题的直接链接">​</a></h3><p>并发与并行：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">* 并发：指两个或多个事件在同一个时间段内发生。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* 并行：指两个或多个事件在同一时刻发生（同时发生）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>线程与进程：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">* 进程：指一个应用程序，是系统运行程序的基本单位，一个应用程序至少有一个进程</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* 线程：是进程中的一个执行单元，一个进程中可以有多个线程。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>线程调度：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">* 分时调度：所有线程轮流使⽤ CPU 的使⽤权，平均分配每个线程占⽤ CPU 的时间。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* 抢占式调度：优先让优先级⾼的线程使⽤ CPU，如果线程的优先级相同，那么会随机选择⼀个（线程随机性）， Java使⽤的为抢占式调度。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-jvm内存区域">1.2 JVM内存区域<a class="hash-link" href="#12-jvm内存区域" title="标题的直接链接">​</a></h3><p>JVM内存区域主要分为：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">* 线程私有：程序计数器、虚拟机栈、本地方法区</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* 线程共享区：Java堆、方法区</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* 直接内存</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>程序计数器：线程私有，记录当前线程所执行的字节码行号指示器</p><p>虚拟机栈：是描述java方法执行的内存模型，每个方法在执行的同时都会创建一个栈帧，用于存储局部变量表，操作数栈，动态链接。方法出口等信息。
每一个方法的调用和执行完成的过程，都对应着一个栈帧在虚拟机栈中入栈到出栈的过程</p><p>本地方法区：和java栈作用类似，区别是虚拟机栈为执行java方法服务，本地方法栈则为Native方法服务</p><p>堆：创建的对象和数组都保存在堆中，也是垃圾收集器进行垃圾收集的最重要的内存区域。
由于现代VM采用分代收集算法，因此java堆还可以从GC的角度分为：新生代（Eden区、From Survivor区和To survivor区）和老年代</p><p>方法区：即永久代，用于存储被JVM加载的类信息、常量、静态变量、即时编译后的代码等数据。
永久代的内存回收主要目标是常量池的回收和类型的卸载，因此收益一般很小</p><blockquote><p>在java8中，永久代已经被移除，被一个成为“元空间”的区域替代。元空间的本质和永久代类似，元空间和永久代最大的区别在于：
元空间并不在虚拟机中而在本地内存中。类的元数据放入元空间，字符串池和静态变量放入Java堆</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-垃圾回收与算法">1.4 垃圾回收与算法<a class="hash-link" href="#14-垃圾回收与算法" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="如何确定垃圾">如何确定垃圾<a class="hash-link" href="#如何确定垃圾" title="标题的直接链接">​</a></h4><ul><li><p>引用计数法：如果一个对象没有任何与之关联的引用，即他们的引用计数为零，则说明对象可能不太会被用到，那么这个对象就是可回收对象</p></li><li><p>可达性分析：为了解决循环引用，以一系列的GCroot对象作为起点搜索，如果对象和GCroot对象之间没有可达路径，则称该对象不可达
当经过至少两次标记后仍然是可回收对象，则面临回收</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="标记清除算法">标记清除算法：<a class="hash-link" href="#标记清除算法" title="标题的直接链接">​</a></h4><p>最基础的垃圾回收算法，分为两阶段，标记和清除。存在内存碎片化严重，后续大对象找不到可利用的空间</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="复制算法">复制算法：<a class="hash-link" href="#复制算法" title="标题的直接链接">​</a></h4><p>为了解决标记清除算法存在的问题而提出的算法。将内存等分为两块，每次使用只使用其中一块，当这一块内存满后将存活对象复制到另一快，然后清理内存
；可用内存压缩到一半，存活对象多的话，复制效率大大降低</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="标记整理算法">标记整理算法：<a class="hash-link" href="#标记整理算法" title="标题的直接链接">​</a></h4><p>结合以上两个算法而提出。标记后不是清理、复制对象，而是将标记后的对象移向内存一段，然后清除存活端以外的对象</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="分代回收算法">分代回收算法：<a class="hash-link" href="#分代回收算法" title="标题的直接链接">​</a></h4><p>是目前大部分JVM采用的方法，其核心思想是根据对象存活的生命周期划分不同的域，一般将GC堆划分为为老生代(Tenured/Old Generation)和新生代(Young
Generation)。老生代的特点是每次垃圾回收时只有少量对象需要被回收，新生代的特点是每次垃
圾回收时都有大量垃圾需要被回收，因此可以根据不同区域选择不同的算法。</p><p>新生代采用复制算法；老年代采用标记整理算法</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="15-java中引用类型">1.5 JAVA中引用类型<a class="hash-link" href="#15-java中引用类型" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="17-gc垃圾收集器">1.7 GC垃圾收集器<a class="hash-link" href="#17-gc垃圾收集器" title="标题的直接链接">​</a></h3><p><img loading="lazy" alt="GC垃圾收集器" src="/assets/images/垃圾收集器-ba093321f42a3f3968e14905badb0c76.png" width="887" height="596" class="img_ev3q"></p><ul><li>Serial：单线程、复制算法</li><li>ParNeW：多线程版本的Serial</li><li>ParallelScavenge：多线程复制算法，高效。保证了高吞吐</li><li>SerialOld：单线程标记整理算法</li><li>ParallelOld：多线程标记整理算法</li><li>CMS：多线程标记清除算法；<ul><li>初始标记：标记与GC Roots直接关联的对象，少量停顿</li><li>并发标记：跟踪GCRoot</li><li>从新标记：修正用户操作而变动的对象</li><li>并发清除：清除不可达对象。</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="18-java-ionio">1.8 JAVA IO/NIO<a class="hash-link" href="#18-java-ionio" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="19-jvm类加载机制">1.9 JVM类加载机制<a class="hash-link" href="#19-jvm类加载机制" title="标题的直接链接">​</a></h3><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-java集合">2 JAVA集合<a class="hash-link" href="#2-java集合" title="标题的直接链接">​</a></h2>]]></content:encoded>
            <category>JVM</category>
        </item>
        <item>
            <title><![CDATA[Home]]></title>
            <link>https://keepli2420.github.io/blog/studay</link>
            <guid>/studay</guid>
            <pubDate>Tue, 21 Mar 2023 00:18:07 GMT</pubDate>
            <description><![CDATA[---]]></description>
            <content:encoded><![CDATA[<h1>DB</h1><hr><blockquote><ul><li>常见的关系型数据库：Oracle、Mysql、SQLServer、Access</li><li>非关系型数据库：MongoDB、Redis、Solr、ElasticSearch、Hive。HBase</li></ul><p>关系型数据库就是由二维表及其之间的关系组成的一个数据集合，以行和列的形式存储数据</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mysql">Mysql<a class="hash-link" href="#mysql" title="标题的直接链接">​</a></h2><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="一全解mysql之架构篇"><a target="_blank" href="/assets/files/全解MySQL之架构篇-a79b375e795a54b164e90d78323006d6.pdf">(一)全解MySQL之架构篇</a><a class="hash-link" href="#一全解mysql之架构篇" title="标题的直接链接">​</a></h3><blockquote><p> <img loading="lazy" alt="1668145128159" src="/assets/images/1668145128159-ed5d651fe807538c050e77c617255ae3.png" width="1113" height="731" class="img_ev3q"></p><ul><li>连接层：主要是指数据库连接池，会负责处理所有客户端接入的工作。</li><li>服务层：主要包含<code>SQL</code>接口、解析器、优化器以及缓存缓冲区四块区域。</li><li>存储引擎层：这里是指<code>MySQL</code>支持的各大存储引擎，如<code>InnoDB、MyISAM</code>等。</li><li>文件系统层：涵盖了所有的日志，以及数据、索引文件，位于系统硬盘上。</li></ul><ol><li><p>网路连接层：TCP协议，半全双工。mysql -h 127.0.0.1 -uroot -p123456。连接成功后创建一个session。
<code>show processlist;</code>   <code> show full processlist</code> 查看运行的线程</p><p>数据库连接池：主要是为了复用线程、管理线程以及限制最大连接数。</p><ol><li><code>show variables like '%max_connections%';</code>：查询目前<code>DB</code>的最大连接数。</li><li><code>set GLOBAL max_connections = 200;</code>：修改数据库的最大连接数为指定值。</li><li><code>MySQL</code>本身还会对客户端的连接数进行统计，对于这点可以通过命令<code>show status like "Threads%";</code><ol><li><code>Threads_cached</code>：目前空闲的数据库连接数。</li><li><code>Threads_connected</code>：当前数据库存活的数据库连接数。</li><li><code>Threads_created</code>：<code>MySQL-Server</code>运行至今，累计创建的连接数。</li><li><code>Threads_running</code>：目前正在执行的数据库连接数。</li></ol></li></ol></li><li><p>系统服务层：<code>MySQL</code>大多数核心功能都位于这一层，包括客户端<code>SQL</code>请求解析、语义分析、查询优化、缓存以及所有的内置函数（例如：日期、时间、统计、加密函数...），所有跨引擎的功能都在这一层实现，譬如存储过程、触发器和视图等一系列服务。</p><ol><li><p>SQL接口组件：负责处理客户端的<code>SQL</code>语句，当客户端连接建立成功之后，会接收客户端的<code>SQL</code>命令，比如<code>DML、DDL</code>语句以及存储过程、触发器等，当收到<code>SQL</code>语句时，<code>SQL</code>接口会将其分发给其他组件，然后等待接收执行结果的返回，最后会将其返回给客户端。</p><ol><li><p>SQL分类：</p><p>DML：数据库操作语句，比如update、delete、insert等都属于这个分类。
DDL：数据库定义语句，比如create、alter、drop等都属于这个分类。
DQL：数据库查询语句，比如最常见的select就属于这个分类。
DCL：数据库控制语句，比如grant、revoke控制权限的语句都属于这个分类。
TCL：事务控制语句，例如commit、rollback、setpoint等语句属于这个分类。</p></li><li><p>触发器：</p><p>存储过程：是指提前编写好的一段较为常用或复杂<code>SQL</code>语句，然后指定一个名称存储起来，然后先经过编译、优化，完成后，这个“过程”会被嵌入到<code>MySQL</code>中。
触发器：则是一种特殊的存储过程。存储过程需要手动调用后才可执行，而触发器可由某个事件主动触发执行。在<code>MySQL</code>中支持<code>INSERT、UPDATE、DELETE</code>三种事件触发，同时也可以通过<code>AFTER、BEFORE</code>语句声明触发的时机，是在操作执行之前还是执行之后。</p></li></ol></li></ol></li></ol><ol start="2"><li><p>解析器： 客户端连接发送的<code>SQL</code>语句，经过<code>SQL</code>接口后会被分发到解析器，解析器的作用主要是做词法分析、语义分析、语法树生成...这类工作的</p></li><li><p>优化器：解析器完成相应的词法分析、语法树生成....等一系列工作后，紧接着会来到优化器，优化器的主要职责在于生成执行计划，比如选择最合适的索引，选择最合适的<code>join</code>方式等，最终会选择出一套最优的执行计划。
优化器生成了执行计划后，维护当前连接的线程会负责根据计划去执行<code>SQL</code>，这个执行的过程实际上是在调用存储引擎所提供的<code>API</code>。</p></li><li><p>缓存&amp;缓冲：主要分为了读取缓存与写入缓冲，读取缓存主要是指<code>select</code>语句的数据缓存，当然也会包含一些权限缓存、引擎缓存等信息，但主要还是<code>select</code>语句的数据缓存，<code>MySQL</code>会对于一些经常执行的查询<code>SQL</code>语句，将其结果保存在<code>Cache</code>中，因为这些<code>SQL</code>经常执行，因此如果下次再出现相同的<code>SQL</code>时，能从内存缓存中直接命中数据，自然会比走磁盘效率更高，对于<code>Cache</code>是否开启可通过命令查询。
<code>  show global variables like "%query_cache_type%";</code>：查询缓存是否开启
<code>show global variables like "%query_cache_size%";</code>：查询缓存的空间大小
同时还可以通过<code>show status like'%Qcache%';</code>命令查询缓存相关的统计信息。</p></li><li><p>存储引擎层： 存储引擎也可以理解成<code>MySQL</code>最重要的一层，在前面的服务层中，聚集了<code>MySQL</code>所有的核心逻辑操作，而引擎层则负责具体的数据操作以及执行工作。
<code>MySQL</code>目前有非常多的存储引擎可选择，其中最为常用的则是<code>InnoDB</code>与<code>MyISAM</code>引擎，可以通过<code>show variables like '%storage_engine%';</code>命令来查看当前所使用的引擎
存储引擎是<code>MySQL</code>数据库中与磁盘文件打交道的子系统，不同的引擎底层访问文件的机制也存在些许细微差异，引擎也不仅仅只负责数据的管理，也会负责库表管理、索引管理等，<code>MySQL</code>中所有与磁盘打交道的工作，最终都会交给存储引擎来完成。</p></li><li><p>文件系统层：这一层则是<code>MySQL</code>数据库的基础，本质上就是基于机器物理磁盘的一个文件系统，其中包含了配置文件、库表结构文件、数据文件、索引文件、日志文件等各类<code>MySQL</code>运行时所需的文件，这一层的功能比较简单，也就是与上层的存储引擎做交互，负责数据的最终存储与持久化工作。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">1. 日志板块： 在`MySQL`中主要存在七种常用的日志类型，如下：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `binlog`二进制日志，主要记录`MySQL`数据库的所有写操作（增删改）。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `redo-log`重做/重写日志，`MySQL`崩溃时，对于未落盘的操作会记录在这里面，用于重启时重新落盘（`InnoDB`专有的）。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `undo-logs`撤销/回滚日志：记录事务开始前[修改数据]的备份，用于回滚事务。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `error-log`：错误日志：记录`MySQL`启动、运行、停止时的错误信息。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `general-log`常规日志，主要记录`MySQL`收到的每一个查询或`SQL`命令。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `slow-log`：慢查询日志，主要记录执行时间较长的`SQL`。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `relay-log`：中继日志，主要用于主从复制做数据拷贝</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2. 数据模块：`MySQL`的所有数据最终都会落盘（写入到磁盘），而不同的数据在磁盘空间中，存储的格式也并不相同，因此再列举出一些`MySQL`中常见的数据文件类型：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `db.opt`文件：主要记录当前数据库使用的字符集和验证规则等信息。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `.frm`文件：存储表结构的元数据信息文件，每张表都会有一个这样的文件。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `.MYD`文件：用于存储表中所有数据的文件（`MyISAM`引擎独有的）。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `.MYI`文件：用于存储表中索引信息的文件（`MyISAM`引擎独有的）。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `.ibd`文件：用于存储表数据和索引信息的文件（`InnoDB`引擎独有的）。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `.ibdata`文件：用于存储共享表空间的数据和索引的文件（`InnoDB`引擎独有）。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `.ibdata1`文件：这个主要是用于存储`MySQL`系统（自带）表数据及结构的文件。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `.ib_logfile0/.ib_logfile1`文件：用于故障数据恢复时的日志文件。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `.cnf/.ini`：`MySQL`的配置文件，`Windows`下是`.ini`，其他系统大多为`.cnf`。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - `......`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr></li></ol></blockquote><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="二一条sql语句从诞生至结束的多姿多彩历程"><a target="_blank" href="/assets/files/全解MySQL-5a5e7bce526455c05c60b68f24132c8e.pdf">(二)一条SQL语句从诞生至结束的多姿多彩历程！</a><a class="hash-link" href="#二一条sql语句从诞生至结束的多姿多彩历程" title="标题的直接链接">​</a></h3><blockquote><ol><li><p>网络层</p><p><img loading="lazy" alt="1668151378960" src="/assets/images/1668151378960-72bc61dc107e5051e4d3d55d0a72d684.png" width="962" height="287" class="img_ev3q"></p><p>当尝试从连接池中获取连接时，如果此时连接池中有空闲连接，可以直接拿到复用，但如果没有，则要先判断一下当前池中的连接数是否已达到最大连接数，如果连接数已经满了，当前线程则需要等待其他线程释放连接对象，没满则可以直接再创建一个新的数据库连接使用。
假设此时连接池中没有空闲连接，需要再次创建一个新连接，那么就会先发起网络请求建立连接。也就等价于在<code>MySQL</code>中创建了一个客户端会话。然后会发生下图一系列工作：</p><p><img loading="lazy" alt="1668151791614" src="/assets/images/1668151791614-303f4f945e23349fe68a8be642bc8327.png" width="1408" height="226" class="img_ev3q"></p></li></ol><ul><li><p>首先会验证客户端的用户名和密码是否正确：</p><ul><li>如果用户名不存在或密码错误，则抛出<code>1045</code>的错误码及错误信息。</li><li>如果用户名和密码验证通过，则进入第②步。</li></ul></li><li><p>判断</p><p>MySQL连接池中是否存在空闲线程：</p><ul><li>存在：直接从连接池中分配一条空闲线程维护当前客户端的连接。</li><li>不存在：创建一条新的工作线程（映射内核线程、分配栈空间....）。</li></ul></li><li><p>工作线程会先查询<code>MySQL</code>自身的用户权限表，获取当前登录用户的权限信息并授权。</p><p>到这里为止，执行<code>SQL</code>前的准备工作就完成了，已经打通了执行<code>SQL</code>的通道，下一步则是准备执行<code>SQL</code>语句，工作线程会等待客户端将<code>SQL</code>传递过来。</p></li></ul><ol start="2"><li>服务层：<code>MySQL</code>执行<code>SQL</code>语句时也会存在些许差异，这里是指读操作和写操作，两者<code>SQL</code>的执行过程并不相同</li></ol><ul><li><p>读：
<img loading="lazy" alt="1668152008461" src="/assets/images/1668152008461-b8aeee8cd8daf79011a7e84f151b89f3.png" width="606" height="559" class="img_ev3q"></p><ul><li>先将<code>SQL</code>发送给<code>SQL</code>接口，<code>SQL</code>接口会对<code>SQL</code>语句进行哈希处理。</li><li><code>SQL</code>接口在缓存中根据哈希值检索数据，如果缓存中有则直接返回数据。</li><li>缓存中未命中时会将SQL交给解析器，解析器会判断SQL语句是否正确：<ul><li>错误：抛出<code>1064</code>错误码及相关的语法错误信息。</li><li>正确：将<code>SQL</code>语句交给优化器处理，进入第④步。</li></ul></li><li>优化器根据<code>SQL</code>制定出不同的执行方案，并择选出最优的执行计划。</li><li>工作线程根据执行计划，调用存储引擎所提供的<code>API</code>获取数据。</li><li>存储引擎根据<code>API</code>调用方的操作，去磁盘中检索数据（索引、表数据....）。</li><li>发送磁盘<code>IO</code>后，对于磁盘中符合要求的数据逐条返回给<code>SQL</code>接口。</li><li><code>SQL</code>接口会对所有的结果集进行处理（剔除列、合并数据....）并返回。</li></ul><p>上述是一个简单的流程概述，一般情况下查询<code>SQL</code>的执行都会经过这些步骤，下面再将每一步拆开详细聊一聊。</p><ol><li><p>SQL接口：</p></li><li><p>当客户端将<code>SQL</code>发送过来之后，<code>SQL</code>紧接着会交给<code>SQL</code>接口处理，首先会对<code>SQL</code>做哈希处理，也就是根据<code>SQL</code>语句计算出一个哈希值，然后去「查询缓存」中比对，如果缓存中存在相同的哈希值，则代表着之前缓存过相同<code>SQL</code>语句的结果，那此时则直接从缓存中获取结果并响应给客户端。如果没有从缓存中查询到数据，紧接着会将<code>SQL</code>语句交给解析器去处理。</p></li><li><p>解析器： 解析器收到<code>SQL</code>后，会开始检测<code>SQL</code>是否正确，也就是做词法分析、语义分析等工作，在这一步，解析器会根据<code>SQL</code>语言的语法规则，判断客户端传递的<code>SQL</code>语句是否合规，如果不合规就会返回<code>1064</code>错误码及错误信息但如果<code>SQL</code>语句没有问题，此时就会对<code>SQL</code>语句进行关键字分析，也就是根据<code>SQL</code>中的<code>SELECT、UPDATE、DELETE</code>等关键字，先判断<code>SQL</code>语句的操作类型，是读操作还是写操作，然后再根据<code>FROM</code>关键字来确定本次<code>SQL</code>语句要操作的是哪张表，也会根据<code>WHERE</code>关键字后面的内容，确定本次<code>SQL</code>的一些结果筛选条件.....。
总之，经过关键字分析后，一条<code>SQL</code>语句要干的具体工作就会被解析出来。
在这一步也就相当于Java中的<code>.java</code>源代码变为<code>.class</code>字节码的过程，目的就是将<code>SQL</code>语句翻译成数据库可以看懂的指令。</p></li><li><p>优化器： 优化器最开始会根据语法树制定出多个执行计划，然后从多个执行计划中选择出一个最好的计划，交给工作线程去执行。`<code>MySQL</code>优化器的一些优化准则如下：</p><ul><li>❶多条件查询时，重排条件先后顺序，将效率更好的字段条件放在前面。</li><li>❷当表中存在多个索引时，选择效率最高的索引作为本次查询的目标索引。</li><li>❸使用分页<code>Limit</code>关键字时，查询到对应的数据条数后终止扫表。</li><li>❹多表<code>join</code>联查时，对查询表的顺序重新定义，同样以效率为准。</li><li>❺对于SQL中使用函数时，如count()、max()、min()...，根据情况选择最优方案。<ul><li><code>max()</code>函数：走<code>B+</code>树最右侧的节点查询（大的在右，小的在左）。</li><li><code>min()</code>函数：走<code>B+</code>树最左侧的节点查询。</li><li><code>count()</code>函数：如果是<code>MyISAM</code>引擎，直接获取引擎统计的总行数。</li><li><code>......</code></li></ul></li><li>❻对于<code>group by</code>分组排序，会先查询所有数据后再统一排序，而不是一开始就排序。</li><li>❼<code>......</code></li></ul><p>总之，根据<code>SQL</code>不同，优化器也会基于不同的优化准则选择出最佳的执行计划。但需要牢记的一点是：MySQL虽然有优化器，但对于效率影响最大的还是SQL本身，因此编写出一条优秀的SQL，才是提升效率的最大要素。</p></li><li><p>存储引擎：经过优化器后，会得到一个最优的执行计划，紧接着工作线程会根据最优计划，去依次调用存储引擎提供的<code>API</code> 工作线程根据执行计划调用存储引擎的<code>API</code>查询指定的表，最终也就是会发生磁盘<code>IO</code>，从磁盘中检索数据，当然，检索的数据有可能是磁盘中的索引文件，也有可能是磁盘中的表数据文件，这点要根据执行计划来决定，我们只需要记住，经过这一步之后总能够得到执行结果即可。</p></li></ol></li><li><p>写</p><p>  <img loading="lazy" alt="1668152866944" src="/assets/images/1668152866944-ed361c3e2cc7b343df4669c5d0a44f69.png" width="636" height="676" class="img_ev3q"></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">* 先将`SQL`发送给`SQL`接口，`SQL`接口会对`SQL`语句进行哈希处理。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* 在缓存中根据哈希值检索数据，如果缓存中有则将对应表的所有缓存全部删除。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* 经过缓存后会将SQL交给解析器，解析器会判断SQL语句是否正确：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  - 错误：抛出`1064`错误码及相关的语法错误信息。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  - 正确：将`SQL`语句交给优化器处理，进入第④步。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* 优化器根据`SQL`制定出不同的执行方案，并择选出最优的执行计划。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* 在执行开始之前，先记录一下`undo-log`日志和`redo-log(prepare状态)`日志。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* 在缓冲区中查找是否存在当前要操作的行记录或表数据（内存中）：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  - 存在：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - 直接对缓冲区中的数据进行写操作。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - 然后利用`Checkpoint`机制刷写到磁盘。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  - 不存在：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - 根据执行计划，调用存储引擎的`API`。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - 发生磁盘`IO`，对磁盘中的数据做写操作。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* 写操作完成后，记录`bin-log`日志，同时将`redo-log`日志中的记录改为`commit`状态。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">* 将`SQL`执行耗时及操作成功的结果返回给`SQL`接口，再由`SQL`接口返回给客户端。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>和读操作的区别：</p></li></ul><ol><li>个表的所有缓存清空，确保缓存的强一致性。</li><li>唯一性判断：如果表中的某个字段建立了唯一约束或唯一索引后，当插入/修改一条数据时，就会先检测一下目前插入/修改的值，是否与表中的唯一字段存在冲突，如果表中已经存在相同的值，则会直接抛出异常，反之会继续执行。</li><li>缓冲区：在真正调用存储引擎的<code>API</code>操作磁盘之前，首先会在「缓冲区」中查找有没有要操作的目标数据/目标表，如果存在则直接对缓冲区中的数据进行操作，然后<code>MySQL</code>会在后台以一种名为<code>Checkpoint</code>的机制，将缓冲区中更新的数据刷回到磁盘。只有当缓冲区没有找到目标数据时，才会去真正调用存储引擎的<code>API</code>，然后发生磁盘<code>IO</code>，去对应磁盘中的表数据进行修改。</li><li>日志：</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"> * undo-log：回滚、事务日志</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   - 如果目前是`insert`插入操作，则生成一个对应的`delete`操作</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   - 如果目前是`delete`删除操作，`InnoDB`中会修改隐藏字段`deleted_bit=1`，则生成改为`0`的语句</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   - 如果目前的`update`修改操作，比如将姓名从竹子改成了熊猫，那就生成一个从熊猫改回竹子的操作</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></blockquote><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="三mysql之库表设计篇-"><a target="_blank" href="/assets/files/MySQL之库表设计篇-782dda2f8bdbb58a0f534f890c9db19a.pdf">(三)MySQL之库表设计篇 </a><a class="hash-link" href="#三mysql之库表设计篇-" title="标题的直接链接">​</a></h3><blockquote><p> 数据库范式中，声名远扬的有三大范式，但除此之外也有一些其他设计规范，如：</p><ul><li>数据库三大范式（<code>1NF、2NF、3NF</code>）</li><li>第四范式(<code>4NF</code>）和第五范式：完美范式（<code>5NF</code>）</li><li>巴斯-科德范式（<code>BCNF</code>）</li><li>反范式设计</li></ul><ol><li><p>三大范式：
三大范式之间，它们是递进的关系。</p><ul><li><p>第一范式：确保原子性，表中每一个列数据都必须是不可再分的字段。</p><p><img loading="lazy" alt="1668406068131" src="/assets/images/1668406068131-3e09e4c40eb7e41dcf9481bccc7e2710.png" width="738" height="221" class="img_ev3q"></p></li><li><p>第二范式：确保唯一性，每张表都只描述一种业务属性，一张表只描述一件事。要求表中的所有列，其数据都必须依赖于主键
<img loading="lazy" alt="1668406275985" src="/assets/images/1668406275985-01d3a85e7a81dd1065d82bea185dbbe9.png" width="1258" height="694" class="img_ev3q"></p></li><li><p>第三范式：确保独立性，表中除主键外，每个字段之间不存在任何依赖，都是独立的。任何非主键字段不能与其他非主键字段间存在依赖关系
<img loading="lazy" alt="1668406679862" src="/assets/images/1668406679862-66cbc3877b96323fc4bfddb6c5704560.png" width="1072" height="464" class="img_ev3q"></p></li></ul></li><li><p>巴斯·科德范式（BCNF）：
巴斯-科德范式并没有定义新的设计规范，仅是对第三范式的做了补充及完善，修正了第三范式。第三范式只要求非主键字段之间，不能存在依赖关系，但没要求联合主键中的字段不能存在依赖，因此第三范式并未考虑完善，巴斯-科德范式修正的就是这点。</p></li><li><p>第四范式：消除表中的多值依赖关系</p></li></ol><ul><li>第一范式：原子性，每个字段的值不能再分。</li><li>第二范式：唯一性，表内每行数据必须描述同一业务属性的数据。</li><li>第三范式：独立性，表中每个非主键字段之间不能存在依赖性。</li><li>巴斯范式：主键字段独立性，联合主键字段之间不能存在依赖性。</li><li>第四范式：表中字段不能存在多值依赖关系。</li><li>第五范式：表中字段的数据之间不能存在连接依赖关系。</li><li>域键范式：试图研究出一个库表设计时的终极完美范式。</li></ul></blockquote><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="四mysql之索引初识篇"><a target="_blank" href="/assets/files/MySQL之索引初识篇-162dffc7876cb99ee49c3f7db15a09d7.pdf">(四)MySQL之索引初识篇</a><a class="hash-link" href="#四mysql之索引初识篇" title="标题的直接链接">​</a></h3><ul><li><p>索引增删改查：</p><ol><li><p>使用create 语句创建：<strong>CREATE</strong> INDEX indexName <strong>ON</strong> tableName (columnName(length) <!-- -->[<strong>ASC</strong>|<strong>DESC</strong>]<!-- -->);</p><ul><li><code>indexName</code>：当前创建的索引，创建成功后叫啥名字。</li><li><code>tableName</code>：要在哪张表上创建一个索引，这里指定表名。</li><li><code>columnName</code>：要为表中的哪个字段创建索引，这里指定字段名。</li><li><code>length</code>：如果字段存储的值过长，选用值的前多少个字符创建索引。</li><li><code>ASC|DESC</code>：指定索引的排序方式，<code>ASC</code>是升序，<code>DESC</code>是降序，默认<code>ASC</code>。</li></ul><p>上述语句中的<code>INDEX</code>也可更改为<code>KEY</code>，作用都是创建一个普通索引，而对于其他的索引类型，这点在后续的索引分类中再聊。</p></li><li><p>使用<strong>ALTER</strong>语句创建：<strong>ALTER</strong> <strong>TABLE</strong> tableName <strong>ADD</strong> INDEX indexName(columnName(length) <!-- -->[<strong>ASC</strong>|<strong>DESC</strong>]<!-- -->);</p></li><li><p>建表时创建：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">TABLE</span><span class="token plain"> tableName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  columnName1 </span><span class="token keyword" style="color:rgb(0, 0, 255)">INT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  columnName2 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">INDEX</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">indexName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">columnName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain">  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>查询、删除索引：</p><ul><li>查询：<strong>SHOW</strong> INDEX FROM tableName;</li><li>删除：<strong>DROP</strong> INDEX indexName <strong>ON</strong> tableName;</li></ul></li></ol></li></ul><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">SELECT * FROM table_name FORCE INDEX(index_name) WHERE .....;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FORCE INDEX 键字可以为一条查询语句强制指定走哪个索引查询，但要牢记的是：如果当前的查询SQL压根不会走指定的索引字段，哪这种方式是行不通的，这个关键字的用法是：一条查询语句在有多个索引可以检索数据时，显式指定一个索引，减少优化器选择索引的耗时。但要注意：如果你对于你整个业务系统十分熟悉，那可以这样干。但如果不熟悉的话，还是交给优化器来自行选择，否则会适得其反！</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>索引分类：</p><ol><li><p>索引数据结构层次：</p><ul><li><code>B+Tree</code>类型：<code>MySQL</code>中最常用的索引结构，大部分引擎支持，有序。</li><li><code>Hash</code>类型：大部分存储引擎都支持，字段值不重复的情况下查询最快，无序。</li><li><code>R-Tree</code>类型：<code>MyISAM</code>引擎支持，也就是空间索引的默认结构类型。</li><li><code>T-Tree</code>类型：<code>NDB-Cluster</code>引擎支持，主要用于<code>MySQL-Cluster</code>服务中。</li></ul><p>在<code>MySQL</code>中创建索引时，其默认的数据结构就为<code>B+Tree</code>，如何更换索引的数据结构呢？如下：</p><p><strong>CREATE</strong> INDEX indexName <strong>ON</strong> tableName (columnName(length) <!-- -->[<strong>ASC</strong>|<strong>DESC</strong>]<!-- -->) <strong>USING</strong> HASH;</p><p>同时索引会被分为有序索引和无序索引，这是指索引文件中存储索引节点时，会不会按照字段值去排序。那一个索引到底是有序还是无序，就是依据数据结构决定的，例如<code>B+Tree、R-Tree</code>等树结构都是有序，而哈希结构则是无序的。</p></li><li><p>字段层次：</p><ul><li>单列索引：基于一个字段建立的索引<ul><li>唯一索引：指索引中的索引节点值不允许重复，一般配合唯一约束使用。</li><li>主键索引：主键索引是一种特殊的唯一索引，和普通唯一索引的区别在于不允许有空值。</li><li>普通索引：通过<code>KEY、INDEX</code>关键字创建的索引就是这个类型，没啥限制，单纯的可以让查询快一点。</li></ul></li><li>多列索引：多个字段组合建立的索引<ul><li>组合索引、联合索引、复合索引、多值索引....</li></ul></li></ul></li><li><p>功能逻辑层次：</p><blockquote><p>请回答一下你知道的<code>MySQL</code>索引类型。这题的答案该怎么回答呢？</p><p>其实主要就是指<code>MySQL</code>索引从逻辑上可以分为那些类型，以功能逻辑划分索引类型，这也是最常见的划分方式，从这个维度来看主要可划分为五种：</p><ul><li><strong>普通索引、唯一索引、主键索引、全文索引、空间索引</strong></li></ul></blockquote><ul><li>全文索引：全文索引类似于<code>ES、Solr</code>搜索中间件中的分词器，或者说和之前常用的<code>like+%</code>模糊查询很类似，它只能创建在<code>CHAR、VARCHAR、TEXT</code>等这些文本类型字段上，而且使用全文索引查询时，条件字符数量必须大于<code>3</code>才生效。</li><li>空间索引：在<code>MySQL</code>中总共支持<code>GEOMETRY、POINT、LINESTRING、POLYGON</code>四种空间数据类型，而空间索引则是基于这些类型的字段建立的，也就是可以帮助我们快捷检索空间数据。</li></ul></li><li><p>存储方式层次：</p><ul><li>聚簇索引：也被称为聚集索引、簇类索引。
逻辑上连续且物理空间上的连续。</li><li>非聚簇索引：也叫非聚集索引、非簇类索引、二级索引、辅助索引、次级索引。
逻辑上的连续但物理空间上不连续。</li></ul><p>一张表中只能存在一个聚簇索引，一般都会选用主键作为聚簇索引，其他字段上建立的索引都属于非聚簇索引，或者称之为辅助索引、次级索引。但也不要走进一个误区，虽然<code>MySQL</code>默认会使用主键上建立的索引作为聚簇索引，但也可以指定其他字段上的索引为聚簇索引，一般聚簇索引要求索引必须是非空唯一索引才行。<code>其实就算表中没有定义主键，</code>InnoDB<code>中会选择一个唯一的非空索引作为聚簇索引，但如果非空唯一索引也不存在，</code>InnoDB`隐式定义一个主键来作为聚簇索引。</p></li></ol><ul><li><p>索引的使用方式</p><ul><li>唯一索引：在创建时，需要通过<code>UNIQUE</code>关键字创建
<img loading="lazy" alt="1668412090014" src="/assets/images/1668412090014-7b1c1d499a5ea174eedc8b6b19930199.png" width="562" height="333" class="img_ev3q"></li></ul><p>在已有的表基础上创建唯一索引时要注意，如果选用的字段，表中字段的值存在相同值时，这时唯一索引是无法创建的</p><ul><li><p>主键索引：是一种特殊的唯一索引，通过<code>PRIMARY</code>关键字创建
<img loading="lazy" alt="1668412109444" src="/assets/images/1668412109444-9dc8720478dca7d46f16f47d83fd8bed.png" width="654" height="323" class="img_ev3q"></p><p>创建主键索引时，必须要将索引字段先设为主键，否则会抛<code>1068</code>错误码。</p><p>这里也不能使用<code>CREATE</code>语句创建索引，否则会提示<code>1064</code>语法错误。</p><p>同时创建索引时，关键字要换成<code>KEY</code>，并非<code>INDEX</code>，否则也会提示语法错误。</p></li><li><p>全文索引：<code>MySQL</code>版本必须要在<code>5.7</code>及以上，使用<code>FULLTEXT</code>关键字
<img loading="lazy" alt="1668412383778" src="/assets/images/1668412383778-3cac75f3c9ba4c99e00f9b42e6d62b42.png" width="685" height="185" class="img_ev3q"></p><p>5.6<code>版本的</code>MySQL<code>中，存储引擎必须为</code>MyISAM`才能创建。</p><p>创建全文索引的字段，其类型必须要为<code>CHAR、VARCHAR、TEXT</code>等文本类型。</p><p>如果想要创建出的全文索引支持中文，需要在最后指定解析器：<code>with parser ngram</code>。</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">TABLE</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    zz_article </span><span class="token keyword" style="color:rgb(0, 0, 255)">ADD</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FULLTEXT </span><span class="token keyword" style="color:rgb(0, 0, 255)">INDEX</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ft_article_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">article_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">WITH</span><span class="token plain"> PARSER NGRAM</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>最小搜索长度和最大搜索长度</strong>：show variables like '%ft%'
全文索引中有两个专门用于检索的关键字：</p><ol><li>MATCH(column)：指定要搜索的列，这里要指定创建全文索引的字段</li><li>AGAINST(关键字)：要搜索的关键字，也就是要搜索的词语</li></ol><p>这两个检索函数也支持三种搜索模式：</p><ol><li><p>自然语言模式(默认搜索模式)
<img loading="lazy" alt="1668413923243" src="/assets/images/1668413923243-a3adb2559e1d1405fe73c4695a305704.png" width="449" height="415" class="img_ev3q"></p></li><li><p>布尔搜索模式：布尔搜索模式有些特殊，因为在这种搜索模式中，还需要掌握特定的搜索语法：</p><ul><li><p><code>+</code>：表示必须匹配的行数据必须要包含相应关键字。</p></li><li><p><code>-</code>：和上面的<code>+</code>相反，表示匹配的数据不能包含相应的关键字。</p></li><li><p><code>&gt;</code>：提升指定关键字的相关性，在查询结果中靠前显示。</p></li><li><p><code>&lt;</code>：降低指定关键字的相关性，在查询结果中靠后显示。</p></li><li><p><code>~</code>：表示允许出现指定关键字，但出现时相关性为负。</p></li><li><p><code>*</code>：表示以该关键字开头的词语，如<code>A*</code>，可以匹配<code>A、AB、ABC....</code></p></li><li><p><code>""</code>：双引号中的关键字作为整体，检索时不允许再分词。</p></li><li><p>"X Y"@n：""包含的多个词语之间的距离必须要在n之间，单位-字节，如：竹子 熊猫@10<code>：表示竹子和熊猫两个词语之间的距离要在</code>10字节内。</p></li><li><p>.......
<img loading="lazy" alt="1668414355797" src="/assets/images/1668414355797-2955e73feba2f3ad25ec70fa95e44725.png" width="515" height="819" class="img_ev3q"></p><p>最后的<code>IN BOOLEAN MODE</code>表示使用布尔搜索模式</p><p>相关性：检索数据后，数据的优先级顺序，当相关性越高，对应数据在结果中越靠前，当相关性为负，则相应的数据排到最后。</p></li></ul></li><li><p>查询拓展搜索：在自然语言模式的查询语句基础上，最后面多加一个<code>WITH QUERY EXPANSION</code>表示使用查询拓展搜索，这种模式下会比自然语言模式多一次检索过程，比如上述的例子中：</p><ul><li>首先会根据指定的关键字<code>MySQL</code>进行一次全文检索。</li><li>然后第二阶段还会对指定的关键进行分词，然后再进行一次全文检索。</li></ul></li><li><p>空间索引：通过<code>SPATIAL</code>关键字创建</p><p>ALTER TABLE tableName ADD SPATIAL KEY indexName(columnName);</p><ul><li>目前<code>MySQL</code>常用引擎中，仅有<code>MyISAM</code>支持空间索引，所以表引擎必须要为它。</li><li>空间索引必须要建立在类型为<code>GEOMETRY、POINT、LINESTRING、POLYGON</code>的字段上。</li></ul></li><li><p>联合索引：它是索引的一种特殊结构，可以使用多个字段建立索引</p><p>CREATE INDEX indexName ON tableName (column1(length),column2...);
ALTER TABLE tableName ADD INDEX indexName(column1(length),column2...);</p><ul><li>你可以使用<code>INDEX</code>关键字，让多个列组成一个普通联合索引</li><li>也可以使用<code>UNIQUE INDEX</code>关键字，让多个列组成一个唯一联合索引</li><li>甚至还可以使用<code>FULLTEXT INDEX</code>关键字，让多个列组成一个全文联合索引</li></ul><p>SELECT语句的查询条件中，必须包含组成联合索引的第一个字段，此时才会触发联合索引，否则是无法使用联合索引的。</p></li></ol></li></ul></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="五mysql索引应用篇"><a target="_blank" href="/assets/files/MySQL索引应用篇-953bff3ce3d67256492ad4cd8b1f6706.pdf">(五)MySQL索引应用篇</a><a class="hash-link" href="#五mysql索引应用篇" title="标题的直接链接">​</a></h3><p>索引优劣势：</p><ul><li><p>优势：</p><p>①整个数据库中，数据表的查询速度直线提升，数据量越大时效果越明显。</p><p>②通过创建唯一索引，可以确保数据表中的数据唯一性，无需额外建立唯一约束。</p><p>③在使用分组和排序时，同样可以显著减少<code>SQL</code>查询的分组和排序的时间。</p><p>④连表查询时，基于主外键字段上建立索引，可以带来十分明显的性能提升。</p><p>⑤索引默认是<code>B+Tree</code>有序结构，基于索引字段做范围查询时，效率会明显提高。</p><p>⑥从<code>MySQL</code>整体架构而言，减少了查询<code>SQL</code>的执行时间，提高了数据库整体吞吐量。</p></li><li><p>劣势：</p><p>①建立索引会生成本地磁盘文件，需要额外的空间存储索引数据，磁盘占用率会变高。</p><p>②写入数据时，需要额外维护索引结构，增、删、改数据时，都需要额外操作索引。</p><p>③写入数据时维护索引需要额外的时间开销，执行写<code>SQL</code>时效率会降低，性能会下降。</p></li></ul><p>索引优劣分析：</p><ul><li>主键索引存在的陷阱：
由于主键索引是聚簇索引，表数据和索引数据在一块、如果主键字段值无序（UUID），那代表着几乎每次插入都有可能导致树结构要调整
因此数据表的主键，最好选用带顺序性的值，否则有可能掉入主键索引的“陷阱”中。</li><li>联合索引存在的矛盾：联合索引生效的前提，查询条件必须包含第一个索引字段。
因此在建立索引时也需要考虑这个问题，确保建立出的联合索引能够命中率够高。</li><li>前缀索引存在的弊端： 前缀索引的特点是短小精悍，我们可以利用一个字段的前<code>N</code>个字符创建索引。相较于使用一个完整字段创建索引，前缀索引能够更加节省存储空间，当数据越多时，带来的优势越明显。
不过前缀索引虽然带来了节省空间的好处，但也正由于其索引节点中，未存储一个字段的完整值，所以<code>MySQL</code>也无法通过前缀索引来完成<code>ORDER BY、GROUP BY</code>等分组排序工作，同时也无法完成覆盖扫描等操作。</li><li>全文索引存在的硬伤：利用全文索引代替<code>like%</code>语法实现模糊查询，它的性能会比<code>like%</code>快上<code>N</code>倍。
但由于全文索引是基于分词实现的，<code>MySQL</code>会对该字段做分词处理，这些分词结果也会被存储在全文索引中，因此全文索引的文件会额外的大！当修改字段值后，分词是需要时间的，所以修改字段数据后不会立马自动更新全文索引，此时需要咱们写存储过程，并调用它手动更新全文索引中的数据
全文索引最大的硬伤在于对中文支持不够友好，英文可以直接通过符号、空格来分词，中文不行
推荐<code>ElasticSearch、Solr、MeiliSearch</code>等搜索引擎</li><li>唯一索引存在的快慢问题：<ul><li>快：查询快。唯一索引和普通的索引区别于其唯一性，当唯一索引找到一条数据后会直接返回而普通索引会继续向下查找。</li><li>慢：插入慢。唯一索引插入时回检查表中是否存在相同数据，普通索引不会。</li></ul></li><li>hash索引的致命问题：采用哈希结构的索引，会以哈希表的形式存储索引字段值，当基于该字段查询数据时，只需要经过一次哈希计算就可获取到数据。
但哈希结构的致命问题在于无序，也就是无法基于哈希索引的字段做排序、分组等工作。</li></ul><p>创建合适的索引</p><ul><li><p>回表：指一条<code>SQL</code>语句在<code>MySQL</code>内部，要经过两次查询过程才能获取到数据
<img loading="lazy" alt="1668417268765" src="/assets/images/1668417268765-67914afb040a3217c4672718d66f2070.png" width="1457" height="653" class="img_ev3q"></p><p>在上图用户表中，基于<code>ID</code>字段先建立了一个主键索引，然后又基于<code>name</code>字段建立了一个普通索引，此时<code>MySQL</code>默认会选用主键索引作为聚簇索引，将表数据和主键索引存在同一个文件中，也就是主键索引的每个索引节点，都直接对应着行数据。而基于<code>name</code>字段建立的索引，其索引节点存放的则是指向聚簇索引的<code>ID</code>值。
<strong>SELECT</strong> * <strong>FROM</strong> <code>zz_user</code> <strong>WHERE</strong> name = "子竹";
这条SQL首先会走<code>name</code>字段的索引，然后找到对应的<code>ID</code>值，然后再基于查询到的<code>ID</code>值，再走<code>ID</code>字段的主键索引，最终得到一整条行数据并返回。这个过程则被称之为回表。</p></li></ul><p>回表动作会导致额外的查询开销，因此尽量可以基于主键做查询，如果实在需要使用非主键字段查询，那么尽量要写明查询的结果字段，而并非使用<code>*</code></p><p><strong>建立索引时要遵守的原则</strong>：</p><ul><li>①经常频繁用作查询条件的字段应酌情考虑为其创建索引。</li><li>②表的主外键或连表字段，必须建立索引，因为能很大程度提升连表查询的性能。</li><li>③建立索引的字段，一般值的区分性要足够高，这样才能提高索引的检索效率。</li><li>④建立索引的字段，值不应该过长，如果较长的字段要建立索引，可以选择前缀索引。</li><li>⑤建立联合索引，应当遵循最左前缀原则，将多个字段之间按优先级顺序组合。</li><li>⑥经常根据范围取值、排序、分组的字段应建立索引，因为索引有序，能加快排序时间。</li><li>⑦对于唯一索引，如果确认不会利用该字段排序，那可以将结构改为<code>Hash</code>结构。</li><li>⑧尽量使用联合索引代替单值索引，联合索引比多个单值索引查询效率要高。</li></ul><p>注意点：</p><ul><li>值经常会增删改的字段，不合适建立索引，因为每次改变后需维护索引结构。</li><li>一个字段存在大量的重复值时，不适合建立索引，比如之前举例的性别字段。</li><li>索引不能参与计算，因此经常带函数查询的字段，并不适合建立索引。</li><li>一张表中的索引数量并不是越多越好，一般控制在3，最多不能超过5。</li><li>建立联合索引时，一定要考虑优先级，查询频率最高的字段应当放首位。</li><li>当表的数据较少，不应当建立索引，因为数据量不大时，维护索引反而开销更大。</li><li>索引的字段值无序时，不推荐建立索引，因为会造成页分裂，尤其是主键索引。</li></ul><p>联合索引的最左前缀原则：联合索引的最左前缀原则，道理很简单的，就是组成联合索引的多个列，越靠左边优先级越高，同时也只有<code>SQL</code>查询条件中，包含了最左的字段，才能使用联合索引。将查询频率越高的字段放首位，就代表着查询时命中索引的几率越大</p><p><strong>索引失效：</strong></p><p>Explain：</p><ul><li><code>id</code>：这是执行计划的<code>ID</code>值，这个值越大，表示执行的优先级越高。</li><li>select_type：当前查询语句的类型，有如下几个值：<ul><li><code>simple</code>：简单查询。</li><li><code>primary</code>：复杂查询的外层查询。</li><li><code>subquery</code>：包含在查询语句中的子查询。</li><li><code>derived</code>：包含在<code>FROM</code>中的子查询。</li></ul></li><li><code>table</code>：表示当前这个执行计划是基于那张表执行的。</li><li>type：当前执行计划查询的类型，有几种情况：
system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL<ul><li><code>all</code>：表示走了全表查询，未命中索引或索引失效。</li><li><code>system</code>：表示要查询的表中仅有一条数据。</li><li><code>const</code>：表示当前<code>SQL</code>语句的查询条件中，可以命中索引查询。</li><li><code>range</code>：表示当前查询操作是查某个区间。</li><li><code>eq_ref</code>：表示目前在做多表关联查询。</li><li><code>ref</code>：表示目前使用了普通索引查询。</li><li><code>index</code>：表示目前<code>SQL</code>使用了辅助索引查询。</li></ul></li><li><code>possible_keys</code>：执行<code>SQL</code>时，优化器可能会选择的索引（最后执行不一定用）。</li><li><code>key</code>：查询语句执行时，用到的索引名字。</li><li><code>key_len</code>：这里表示索引字段使用的字节数。</li><li><code>ref</code>：这里显示使用了那种查询的类型。</li><li><code>rows</code>：当前查询语句可能会扫描多少行数据才能检索出结果。</li><li>Extra：这里是记录着额外的一些索引使用信息，有几种状态：<ul><li><code>using index</code>：表示目前使用了覆盖索引查询（稍后讲）。</li><li><code>using where</code>：表示使用了<code>where</code>子句查询，通常表示没使用索引。</li><li><code>using index condition</code>：表示查询条件使用到了联合索引的前面几个字段。</li><li><code>using temporary</code>：表示使用了临时表处理查询结果。</li><li><code>using filesort</code>：表示以索引字段之外的方式进行排序，效率较低。</li><li><code>select tables optimized away</code>：表示在索引字段上使用了聚合函数。</li></ul></li></ul><p>失效场景：</p><ol><li>查询中带有OR：</li><li>模糊查询中like以%开头</li><li>字符串类型查询，条件不带引号</li><li>索引字段参与计算：<code>+、-、*、/、!.....</code></li><li>索引字段用于函数计算</li><li>违背最左前缀原则：</li><li>不同字段值对于比：从一张表中查询出一些值，然后根据这些值去其他表中筛选数据
EXPLAIN <strong>SELECT</strong> * <strong>FROM</strong> <code>zz_users</code> <strong>WHERE</strong> user_name = user_sex;</li><li>反向范围操作：
正向范围：<code>&gt;、&lt;、between、like、in...</code>
反向范围：<code>NOT IN、NOT LIKE、IS NOT NULL、!=、&lt;&gt;...</code></li></ol><p>在<code>MySQL</code>中还有一种特殊情况会导致索引失效，也就是当走索引扫描的行数超过表行数的<code>30%</code>时，<code>MySQL</code>会默认放弃索引查询，转而使用全表扫描的方式检索数据，因此这种情况下走索引的顺序磁盘<code>IO</code>，反而不一定有全表的随机磁盘<code>IO</code>快。</p><p>关于索引是否会失效，实际上也跟索引的数据结构、<code>MySQL</code>的版本、存储引擎的不同有关，例如一条<code>SQL</code>语句在<code>B+Tree</code>索引中会导致索引失效，但在哈希索引中却不会（好比<code>IS NULL/IS NOT NULL</code>），这种情况在不同版本、不同引擎中都有可能会体现出来。</p><p>总结如下：</p><ul><li>①查询<code>SQL</code>中尽量不要使用<code>OR</code>关键字，可以使用多<code>SQL</code>或子查询代替。</li><li>②模糊查询尽量不要以<code>%</code>开头，如果实在要实现这个功能可以建立全文索引。</li><li>③编写<code>SQL</code>时一定要注意字段的数据类型，否则<code>MySQL</code>的隐式转换会导致索引失效。</li><li>④一定不要在编写<code>SQL</code>时让索引字段执行计算工作，尽量将计算工作放在客户端中完成。</li><li>⑤对于索引字段尽量不要使用计算类函数，一定要使用时请记得将函数计算放在<code>=</code>后面。</li><li>⑥多条件的查询<code>SQL</code>一定要使用联合索引中的第一个字段，否则会打破最左匹配原则。</li><li>⑦对于需要对比多个字段的查询业务时，可以拆分为连表查询，使用临时表代替。</li><li>⑧在<code>SQL</code>中不要使用反范围性的查询条件，大部分反范围性、不等性查询都会让索引失效。</li><li>⑨<code>.......</code></li></ul><p>实际上无非就是根据前面给出的索引失效情况，尽量让自己编写的<code>SQL</code>不会导致索引失效即可，写出来的<code>SQL</code>能走索引查询，那就能在很大程度上提升数据检索的效率。</p><p><strong>索引覆盖：</strong>要查询的列被联合索引包含</p><p><strong>索引下推：</strong>索引下推是<code>MySQL5.6</code>版本以后引入的一种优化机制，默认开启
set optimizer_switch='index_condition_pushdown=off|on'</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"熊猫"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"女"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"6666"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> :     </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"竹子"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"男"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"1234"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> :     </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"子竹"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"男"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"4321"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> :     </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"1111"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"男"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"4321"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> :     </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"竹竹"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"女"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"8888"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> :     </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">FROM</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(4, 81, 165)">`</span><span class="token identifier">zz_users</span><span class="token identifier punctuation" style="color:rgb(4, 81, 165)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">WHERE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(4, 81, 165)">`</span><span class="token identifier">user_name</span><span class="token identifier punctuation" style="color:rgb(4, 81, 165)">`</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"竹%"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">AND</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(4, 81, 165)">`</span><span class="token identifier">user_sex</span><span class="token identifier punctuation" style="color:rgb(4, 81, 165)">`</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">"男"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">利用联合索引中的user_name字段找出「竹子、竹竹」两个索引节点。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">返回索引节点存储的值「</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">、</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain">」给Server层，然后去逐一做回表扫描。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">在Server层中根据user_sex</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">"男"</span><span class="token plain">这个条件逐条判断，最终筛选到「竹子」这条数据。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">索引下推</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">利用联合索引中的user_name字段找出「竹子、竹竹」两个索引节点。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">根据user_sex</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">"男"</span><span class="token plain">这个条件在索引节点中逐个判断，从而得到「竹子」这个节点。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">最终将「竹子」这个节点对应的「</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">」返回给Server层，然后聚簇索引中回表拿数据。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>MRR(Multi-Range Read)机制</strong>：简称为<strong>MRR</strong>机制，<code>MySQL5.6</code>及以后的版本是默认开启的
<strong>SELECT</strong> * <strong>FROM</strong> <code>zz_student_score</code> <strong>WHERE</strong> <code>score</code> <strong>BETWEEN</strong> 0 <strong>AND</strong> 59;</p><p>这条<code>SQL</code>的执行流程是什么样的呢？</p><ul><li>先在成绩字段的索引上找到<code>0</code>分的节点，然后拿着<code>ID</code>去回表得到成绩零分的学生信息。</li><li>再次回到成绩索引，继续找到所有<code>1</code>分的节点，继续回表得到<code>1</code>分的学生信息。</li><li>再次回到成绩索引，继续找到所有<code>2</code>分的节点......</li><li>周而复始，不断重复这个过程，直到将<code>0~59</code>分的所有学生信息全部拿到为止。</li></ul><p><strong>MRR</strong>机制就主要是解决这个问题的，针对于辅助索引的回表查询，减少离散<code>IO</code>，并且将随机<code>IO</code>转换为顺序<code>IO</code>，从而提高查询效率
<strong>MRR</strong>机制中，对于辅助索引中查询出的<code>ID</code>，会将其放到缓冲区的<code>read_rnd_buffer</code>中，然后等全部的索引检索工作完成后，或者缓冲区中的数据达到<code>read_rnd_buffer_size</code>大小时，此时<code>MySQL</code>会对缓冲区中的数据排序，从而得到一个有序的<code>ID</code>集合：<code>rest_sort</code>，最终再根据顺序<code>IO</code>去聚簇/主键索引中回表查询数据。
SET @@optimizer_switch='mrr=on|off,mrr_cost_based=on|off';</p><p><strong>Index Skip Scan索引跳跃式扫描：</strong><code>MySQL8.x</code>版本中加入索引跳跃式扫描
SELECT @@optimizer_switch
set @@optimizer_switch = 'skip_scan=on|off'
跳跃扫描机制也有很多限制，比如多表联查时无法触发、<code>SQL</code>条件中有分组操作也无法触发、<code>SQL</code>中用了<code>DISTINCT</code>去重也无法触发.....</p><p>跳跃性扫描机制，只有在唯一性较差的情况下，才能发挥出不错的效果，如果你联合索引的第一个字段，是一个值具备唯一性的字段，那去重一次再拼接，几乎就等价于走一次全表。</p><p><code>show status like '%Handler_read%';</code>查看当前会话的索引使用情况。
<code>show global status like 'Handler_read%';</code>：查询全局索引使用情况。</p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="六mysql索引原理篇"><a target="_blank" href="/assets/files/MySQL索引原理篇-51082abde286cd2b815634edf3478051.pdf">(六)MySQL索引原理篇</a><a class="hash-link" href="#六mysql索引原理篇" title="标题的直接链接">​</a></h3><p>为什么建立索引：</p><p>没有索引每次查询都会扫描全表，因为表中没有主键、唯一索引。
全表扫描：每触发一次磁盘IO，就会从磁盘中读取一部分数据到内存，然后对内存中的数据进行遍历判断
符合写到结果集中。如果表中还有其他数据，则继续触发磁盘IO，如果没有则将结果集返回。</p><p>Mysql为什么选择B+Tree结构：
<img loading="lazy" alt="B+树-叶子节点" src="data:image/webp;base64,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" width="643" height="345" class="img_ev3q">
B+Tree：分为叶节点和叶子节点。叶节点存储的是指针地址，叶子节点存储的是数据或是主键
叶节点中不会存储数据，仅存储指向叶子节点的指针，这样做的好处在于能够让一个叶节点中存储更多的元素，从而确保树的高度不会由于数据增长而变得很高。</p><p>B+Tree变种：设计索引结构时，对于原始的<code>B+Tree</code>又一次做了改造，叶子节点之间除开一根单向的指针之外，又多新增了一根指针，指向前面一个叶子节点，也就是<code>MySQL</code>索引底层的结构，实际是<code>B+Tree</code>的变种，叶子节点之间是互存指针的，所有叶子节点是一个双向链表结构。
这样做的好处在于：即可以快速按正序进行范围查询，而可以快速按倒序进行范围操作，在某些业务场景下又能进一步提升整体性能</p><p>索引为什么不选择二叉树？</p><p><img loading="lazy" alt="二叉树" src="/assets/images/2337f8fa9e674edab29a4926a433652d_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0-d7b9e2eec8e0d6e5eab1ee44bd498a24.webp" width="678" height="396" class="img_ev3q"></p><p>①如果索引的字段值是按顺序增长的，二叉树会转变为链表结构。
②由于结构转变成了链表结构，因此检索的过程和全表扫描无异。
③由于树结构在磁盘中，各节点的数据并不连续，因此无法利用局部性原理。</p><p>红黑树：
<img loading="lazy" alt="红黑树" src="/assets/images/e75449bc8f6545aa8d797b7900045f82_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0-c826ac32bcb13984bdb91a008f644139.webp" width="678" height="396" class="img_ev3q"></p><p>①虽然对比二叉树来说，树高有所降低，但数据量一大时，依旧会有很大的高度。
②每个节点中只存储一个数据，节点之间还是不连续的，依旧无法利用局部性原理。</p><p>B-Tree：</p><p><img loading="lazy" alt="B-Tree" src="/assets/images/4e81f509887e41e2a25656e8c8321b5d_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0-9dded4f73a2856269f6e5c620883567d.webp" width="678" height="396" class="img_ev3q">
①虽然对比之前的红黑树更矮，检索数据更快，也能够充分利用局部性原理减少<code>IO</code>次数，但对于大范围查询的需求，依旧需要通过多次磁盘<code>IO</code>来检索数据。</p><p>索引创建后发生的事情：</p><p>当手动创建索引后，<code>MySQL</code>会先看一下当前表的存储引擎是谁，接着会判断一下表中是否存在数据，如果表中没有数据，则直接构建一些索引的信息，例如索引字段是谁、索引键占多少个字节、创建的是啥类型索引、索引的名字、索引归属哪张表、索引的数据结构.....，然后直接写入对应的磁盘文件中，比如<code>MyISAM</code>的表则写入到<code>.MYI</code>文件中，<code>InnoDB</code>引擎的表则写入到<code>.ibd</code>文件中。
当表中有数据时，首先<code>MySQL-Server</code>会先看一下目前要创建什么类型的索引，然后基于索引的类型对索引字段的值，进行相应的处理，比如：</p><ul><li>唯一索引：判断索引字段的每个值是否存在重复值，如果有则抛出错误码和信息。</li><li>主键索引：判断主键字段的每个值是否重复、是否有空值，有则抛出错误信息。</li><li>全文索引：判断索引字段的数据类型是否为文本，对索引字段的值进行分词处理。</li><li>前缀索引：对于索引字段的值进行截取工作，选用指定范围的值作为索引键。</li><li>联合索引：对于组成联合索引的多个列进行值拼接，组成多列索引键。</li><li><code>........</code></li></ul><p>根据索引类型做了相应处理后，紧接着会再看一下当前索引的数据结构是什么？是<code>B+Tree、Hash</code>亦或是其他结构，然后根据数据结构对索引字段的值进行再次处理，如：</p><ul><li><code>B+Tree</code>：对索引字段的值进行排序，按照顺序组成<code>B+</code>树结构。</li><li><code>Hash</code>：对索引字段的值进行哈希计算，处理相应的哈希冲突，方便后续查找。</li></ul><p>对索引字段的值处理好了，此时就会准备将内存中处理好的字段数据，写入到本地相应的磁盘文件中那在写入前还会做最后一个判断，也就是判断当前的索引是否为主键/聚簇索引：
如果当前创建索引的字段是主键字段，则在写入时重构<code>.ibd</code>文件中的数据，将索引键和行数据调整到一块区域中存储。不是主键/聚簇索引，或者目前是<code>MyISAM</code>引擎，则意味着现在需要创建的是非聚簇索引，因此会先会为每个索引键（索引字段值）寻找相应的行数据，找到之后与索引键关联起来</p><p><code>InnoDB</code>引擎中的非聚簇索引，都是主键/聚簇索引附，因此每个索引信息中是以「索引键：聚簇字段值」这种形式关联的。
<code>MyISAM</code>引擎中由于表数据和索引数据都是分开存储的，所以<code>MyISAM</code>的每个非聚簇索引都是独立的，因此每个索引信息则是以「索引键：行数据的地址指针」这种形式关联。</p><p>聚簇和非聚簇区别：
<img loading="lazy" alt="聚簇索引与非聚簇索引" src="/assets/images/18f461b68ada474ab66ca63666311d79_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0-45ad54e065a2996f21ae337c36725624.webp" width="1735" height="768" class="img_ev3q"></p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="七mysql事务篇"><a target="_blank" href="/assets/files/MySQL事务篇-47a2f416badf65b6d243ad9ed1d9a95f.pdf">(七)MySQL事务篇</a><a class="hash-link" href="#七mysql事务篇" title="标题的直接链接">​</a></h3><ul><li><p>事务的ACID：</p><ul><li><code>A/Atomicity</code>：原子性</li><li><code>C/Consistency</code>：一致性</li><li><code>I/Isolation</code>：独立性/隔离性</li><li><code>D/Durability</code>：持久性</li></ul><p>原子性：
一组SQL要么都成功要么都失败</p><p>一致性：
数据的一致性。SQL执行前的数据是一致的，执行后数据还是一致的。
添加用户成功后，用户角色也必须添加成功，使数据完整、一致。</p><p>独立性/隔离性：
事务和事务之间互不影响</p><p>持久性：
事务一旦被提交，修改的数据就会被写入磁盘做持久化处理</p></li><li><p>事务管理
手动管理事务：</p><ul><li><code>start transaction | begin | begin work</code>：开启一个事务</li><li><code>commit</code>：提交一个事务</li><li><code>rollback</code>：回滚一个事务</li><li>SHOW VARIABLES LIKE autocommit; 查看自动提交事务是否开启
SET autocommit = 0|1|ON|OFF;关闭或开启自动提交</li><li>savepoint point_name`：添加一个事务回滚点</li><li>rollback to point_name：回滚到指定的事务回滚点</li></ul></li></ul><ul><li><p>事务隔离机制</p><ul><li><code>Read uncommitted/RU</code>：未提交读</li><li><code>Read committed/RC</code>：已提交读</li><li><code>Repeatable read/RR</code>：可重复读</li><li><code>Serializable</code>：序列化/串行化</li></ul><p>脏读、幻读、不可重复读</p><ul><li>脏读：一个事务读到了其他事务还未提交的数据</li><li>不可重复读：一个事务每次读取的数据都不一样</li><li>幻读：一个事务在第一个事务要处理的目标数据范围之内新增了数据。另一个事务先于第一个事务提交造成的问题。</li></ul><p>脏写：两个事务同时向表中添加一条<code>ID=88</code>的数据，此时就会造成数据覆盖，或者主键冲突的问题，这个问题也被称之为更新丢失问题。</p></li><li><p>事务的隔离级别解决了什么问题：</p><ul><li>未提交读：处于该隔离级别的数据库，脏读、不可重复读、幻读问题都有可能发生。</li><li>已提交读：处于该隔离级别的数据库，解决了脏读问题，不可重复读、幻读问题依旧存在。</li><li>可重复读：处于该隔离级别的数据库，解决了脏读、不可重复读问题，幻读问题依旧存在。默认级别</li><li>序列化/串行化：处于该隔离级别的数据库，解决了脏读、不可重复读、幻读问题都不存在。</li></ul><p>查询方式
SELECT @@transaction_isolation ;
SELECT @@tx_isolation;
show variables like '%transaction_isolation %';
show variables like '%tx_isolation%';</p><p>设置方式：
当前连接有效：SET transaction_isolation = 'read-committed'
全局有效：SET  global.transaction_isolation = 'serializable'; </p></li><li><p>未提交读：这种隔离级别是基于「写互斥锁」实现的，当一个事务开始写某一个数据时，另外一个事务也来操作同一个数据，此时为了防止出现问题则需要先获取锁资源，只有获取到锁的事务，才允许对数据进行写操作，同时获取到锁的事务具备排他性/互斥性，也就是其他线程无法再操作这个数据。这个级别中解决了前面说到的脏写问题。</p></li><li><p>提交读：在这个隔离级别中，对于写操作同样会使用「写互斥锁」，也就是两个事务操作同一事务时，会出现排他性，而对于读操作则使用了一种名为<code>MVCC</code>多版本并发控制的技术处理，也就是有事务中的<code>SQL</code>需要读取当前事务正在操作的数据时，<code>MVCC</code>机制不会让另一个事务读取正在修改的数据，而是读取上一次提交的数据（也就是读原本的老数据），每次读取都会创建一个新的ReadView。</p></li><li><p>可重复读：在可重复读级别中，不会每次查询时都创建新的<code>ReadView</code>，而是在一个事务中，只有第一次执行查询会创建一个<code>ReadView</code>，在这个事务的生命周期内，所有的查询都会从这一个<code>ReadView</code>中读取数据，从而确保了一个事务中多次读取相同数据是一致的，也就是解决了不可重复读问题。</p></li><li><p>序列化/串行化级别：这个隔离级别是最高的级别，处于该隔离级别的<code>MySQL</code>绝不会产生任何问题，因为从它的名字上就可以得知：序列化意思是将所有的事务按序排队后串行化处理，也就是操作同一张表的事务只能一个一个执行，事务在执行前需要先获取表级别的锁资源，拿到锁资源的事务才能执行，其余事务则陷入阻塞，等待当前事务释放锁。</p></li></ul><ul><li><p>原子性要求事务中所有操作要么全部成功，要么全部失败，这点是基于<code>undo-log</code>来实现的，因为在该日志中会生成相应的反<code>SQL</code>，执行失败时会利用该日志来回滚所有写入操作。</p></li><li><p>持久性要求的是所有<code>SQL</code>写入的数据都必须能落入磁盘存储，确保数据不会丢失，这点则是基于<code>redo-log</code>实现的，具体的实现过程在前面事务恢复机制讲过。</p></li><li><p>隔离性的要求是一个事务不会受到另一个事务的影响，对于这点则是通过锁机制和<code>MVCC</code>机制实现的，只不过<code>MySQL</code>屏蔽了加锁和<code>MVCC</code>的细节，具体的会在后续章节中细聊。</p></li><li><p>一致性要求数据库的整体数据变化，只能从一个一致性状态变为另一个一致性状态，其实前面的原子性、持久性、隔离性都是为了确保这点而存在的。</p></li></ul><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="八mysql锁机制"><a target="_blank" href="/assets/files/MySQL锁机制-f1983f3f8fb5eea740eb6e8e617e5b55.pdf">(八)MySQL锁机制</a><a class="hash-link" href="#八mysql锁机制" title="标题的直接链接">​</a></h3><p><code>MySQL</code>的锁体系：</p><ul><li>以锁粒度的维度划分：<ul><li>①表锁：<ul><li>全局锁：加上全局锁之后，整个数据库只能允许读，不允许做任何写操作。</li><li>元数据锁 / <code>MDL</code>锁：基于表的元数据加锁，加锁后整张表不允许其他事务操作。</li><li>意向锁：这个是<code>InnoDB</code>中为了支持多粒度的锁，为了兼容行锁、表锁而设计的。</li><li>自增锁 / <code>AUTO-INC</code>锁：这个是为了提升自增ID的并发插入性能而设计的。</li></ul></li><li>②页面锁</li><li>③行锁：<ul><li>记录锁 / <code>Record</code>锁：也就是行锁，一条记录和一行数据是同一个意思。</li><li>间隙锁 / <code>Gap</code>锁：<code>InnoDB</code>中解决幻读问题的一种锁机制。</li><li>临建锁 / <code>Next-Key</code>锁：间隙锁的升级版，同时具备记录锁+间隙锁的功能。</li></ul></li></ul></li><li>以互斥性的维度划分：<ul><li>共享锁 / <code>S</code>锁：不同事务之间不会相互排斥、可以同时获取的锁。</li><li>排他锁 / <code>X</code>锁：不同事务之间会相互排斥、同时只能允许一个事务获取的锁。</li><li>共享排他锁 / <code>SX</code>锁：<code>MySQL5.7</code>版本中新引入的锁，主要是解决<code>SMO</code>带来的问题。</li></ul></li><li>以操作类型的维度划分：<ul><li>读锁：查询数据时使用的锁。</li><li>写锁：执行插入、删除、修改、<code>DDL</code>语句时使用的锁。</li></ul></li><li>以加锁方式的维度划分：<ul><li>显示锁：编写<code>SQL</code>语句时，手动指定加锁的粒度。</li><li>隐式锁：执行<code>SQL</code>语句时，根据隔离级别自动为<code>SQL</code>操作加锁。</li></ul></li><li>以思想的维度划分：<ul><li>乐观锁：每次执行前认为自己会成功，因此先尝试执行，失败时再获取锁。</li><li>悲观锁：每次执行前都认为自己无法成功，因此会先获取锁，然后再执行。
放眼望下来，是不是看着还蛮多的，但总归说来说去其实就共享锁、排他锁两种，只是加的方式不同，加的地方不同，因此就演化出了这么多锁的称呼。</li></ul></li></ul><p>共享锁
SELECT ... LOCK IN SHARE MODE;
-- MySQL8.0之后也优化了写法，如下：
SELECT ... FOR SHARE;</p><p>排它锁
SELECT ... FOR UPTATE;</p><p>表锁：
MyISAM引擎中获取读锁（具备读-读可共享特性）
LOCK TABLES <code>table_name</code> READ;
MyISAM引擎中获取写锁（具备写-读、写-写排他特性）
LOCK TABLES <code>table_name</code> WRITE;
查看目前库中创建过的表锁（in_use&gt;0表示目前正在使用的表锁）
SHOW OPEN TABLES WHERE in_use &gt; 0;
释放已获取到的锁
UNLOCK TABLES;
MyISAM引擎中，获取了锁还需要自己手动释放锁，否则会造成死锁现象出现，因为如果不手动释放锁，就算事务结束也不会自动释放，除非当前的数据库连接中断时才会释放。</p><ul><li><p>元数据锁：<code>Meta Data Lock</code>元数据锁，也被简称为<code>MDL</code>锁，这是基于表的元数据加锁。
所有存储引擎的表都会存在一个.frm文件，这个文件中主要存储表的结构（DDL语句），而<code>DML</code>锁就是基于<code>.frm</code>文件中的元数据加锁的。
这个锁主要是用于：更改表结构时使用</p></li><li><p>意向锁：意向锁则是<code>InnoDB</code>中为了支持多粒度的锁，为了兼容行锁、表锁而设计的。
当事务<code>T1</code>打算对<code>ID=8888888</code>这条数据加一个行锁之前，就会先加一个表级别的意向锁。此时当事务<code>T2</code>尝试获取一个表级锁时，就会先看一下表上是否有意向锁，如果有的话再判断一下与自身是否冲突，比如表上存在一个意向共享锁，目前<code>T2</code>要获取的是表级别的读锁，那自然不冲突可以获取。但反之，如果<code>T2</code>要获取一个表记的写锁时，就会出现冲突，<code>T2</code>事务则会陷入阻塞，直至<code>T1</code>释放了锁（事务结束）为止。</p></li><li><p>自增锁：自增锁也是一种特殊的表锁，但它仅为具备<code>AUTO_INCREMENT</code>自增字段的表服务。同时自增锁也分成了不同的级别，可以通过<code>innodb_autoinc_lock_mode</code>参数控制。</p><p>三种插入类型：</p><ul><li>普通插入：指通过<code>INSERT INTO table_name(...) VALUES(...)</code>这种方式插入。</li><li>批量插入：指通过<code>INSERT ... SELECT ...</code>这种方式批量插入查询出的数据。</li><li>混合插入：指通过<code>INSERT INTO table_name(id,...) VALUES(1,...),(NULL,...),(3,...)</code>这种方式插入，其中一部分指定<code>ID</code>，一部分不指定。</li></ul><ul><li><code>innodb_autoinc_lock_mode = 0</code>：传统模式
单线程</li><li><code>innodb_autoinc_lock_mode = 1</code>：连续模式（<code>MySQL8.0</code>以前的默认模式）
普通插入，采用预读的方式。因为普通插入可以确定插入数量，然后范围自增。
批量和混入不能采用预读的方式，还是单线程</li><li><code>innodb_autoinc_lock_mode = 2</code>：交错模式（<code>MySQL8.0</code>之后的默认模式）
事务<code>T1、T2</code>都要执行批量插入的操作<code>T1</code>分配<code>{1、3、5、7、9....}</code>，给<code>T2</code>分配<code>{2、4、6、8、10.....}</code>，然后两个事务交错插入，这样岂不是做到了自增值即不重复但自增值有可能出现空隙</li></ul></li><li><p>全局锁：是一种尤为特殊的表锁，其实将它称之为库锁也许更合适。一般全局锁是在对整库做数据备份时使用。
获取全局锁的命令  FLUSH TABLES WITH READ LOCK;
释放全局锁的命令  UNLOCK TABLES;</p></li></ul><p>行锁：
目前仅InnoDB引擎支持行锁。因为InnoDB支持聚簇索引，如果命中索引则加行锁，否则加表锁</p><ul><li><p>记录锁：实际上就是行锁，一行表数据、一条表记录本身就是同一个含义，因此行锁也被称为记录锁</p></li><li><p>间隙锁：间隙锁是对行锁的一种补充，主要是用来解决幻读问题的
间隙：主键不连续。间隙锁锁定的就是缺少的主键，空数据。
幻读：一个事务执行时，另一个事务插入了一条数据。当第一个事务执行完后，发现结果与预期不一致。
对于新增的数据称为幻影数据。</p></li><li><p>临键锁：临键锁是间隙锁的<code>Plus</code>版本，或者可以说成是一种由记录锁+间隙锁组成的锁：</p><ul><li>记录锁：锁定的范围是表中具体的一条行数据。</li><li>间隙锁：锁定的范围是左闭右开的区间，并不包含最后一条真实数据。</li></ul><p>当<code>T1</code>要对<code>ID&gt;3</code>的用户做密码重置，锁定<code>4、9</code>这两条行数据时，默认会加的是临键锁，也就是当事务<code>T2</code>尝试插入<code>ID=6</code>的数据时，因为有临建锁存在，因此无法再插入这条“幻影数据”，也就至少保障了<code>T1</code>事务执行过程中，不会碰到幻读问题</p></li><li><p>插入意向锁：插入意向锁是一种间隙锁 ，这种锁是一种隐式锁，无法手动的获取这种锁。通常在<code>MySQL</code>中插入数据时，是并不会产生锁的，但在插入前会先简单的判断一下，当前事务要插入的位置有没有存在间隙锁或临键锁，如果存在的话，当前插入数据的事务则需阻塞等待，直到拥有临键锁的事务提交。
能够真正执行的插入语句，绝对是通过了唯一检测的，因此插入时可以让多事务并发执行，同时如果设置了自增<code>ID</code>，也会获取自增锁确保安全性，所以当多个事务要向一个区间插入数据时，插入意向锁是不会排斥其他事务的，从这种角度而言，插入意向锁也是一种共享锁。</p></li></ul><p>锁粗化：行锁会在某些特殊情况下发生粗化，主要有两种情况：</p><ul><li>在内存中专门分配了一块空间存储锁对象，当该区域满了后，就会将行锁粗化为表锁。</li><li>当做范围性写操作时，由于要加的行锁较多，此时行锁开销会较大，也会粗化成表锁。</li></ul><p>页面锁、乐观锁和悲观锁
表锁：以表为粒度，锁住的是整个表数据。
行锁：以行为粒度，锁住的是一条数据。
页锁：以页为粒度，锁住的是一页数据。
乐观锁：每次执行都认为只会有自身一条线程操作，因此无需拿锁直接执行。
悲观锁：每次执行都认为会有其他线程一起来操作，因此每次都需要先拿锁再执行。</p><ul><li><p>页面锁：估计就是只一个索引页的大小，即<code>16KB</code>左右。</p></li><li><p>乐观锁：一般都是基于<code>CAS</code>思想实现的，而在<code>MySQL</code>中则可以通过<code>version</code>版本号+<code>CAS</code>的形式实现乐观锁，也就是在表中多设计一个<code>version</code>字段，然后在<code>SQL</code>修改时以如下形式操作：
UPDATE ... SET version = version + 1 ... WHERE ... AND version = version;
一般的乐观锁都会配合轮询重试机制，比如上述<code>T1</code>执行失败后，再次执行相同语句，直到成功为止。
乐观锁更加适用于读大于写的业务场景，频繁写库的业务则并不适合加乐观锁。</p><ul><li>悲观锁：即每次执行时都会先加锁再执行</li></ul></li></ul><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="九mysql之mvcc机制"><a target="_blank" href="/assets/files/MySQL之MVCC机制-335b1abe2d6163e9349e842bee80c980.pdf">(九)MySQL之MVCC机制</a><a class="hash-link" href="#九mysql之mvcc机制" title="标题的直接链接">​</a></h3><p>MVCC机制的全称为<code>Multi-Version Concurrency Control</code>，即多版本并发控制技术，主要是为了提升数据库并发性能而设计的，其中采用更好的方式处理了读-写并发冲突，做到即使有读写冲突时，也可以不加锁解决，从而确保了任何时刻的读操作都是非阻塞的。
目前只有InnoDB实现了这种机制</p><p>并发事务的四种场景：</p><ul><li><p>读-读：不会有并发问题</p></li><li><p>写-写：写覆盖问题。脏写</p></li><li><p>读-写：脏读、不可重复读、幻读</p></li><li><p>写-读：脏读、不可重复读、幻读</p><p><code>MySQL</code>中仅在<code>RC</code>读已提交级别、<code>RR</code>不可重复读级别才会使用<code>MVCC</code>机制，且这种机制只有InnoDB实现</p></li></ul><p>MVCC <code>三剑客</code></p><ul><li>隐藏字段：基于InnoDB创建表时，还会构建一些隐藏字段，主要有：<ul><li>DB_ROW_ID（6Bytes）：InnoDB隐式定义的顺序递增的主键。用于创建索引树</li><li>DB_Deleted_Bit：删除标识0/1；添加、删除都会导致索引树结构的改变。删除时只会改变该值</li><li>DB_TRX_ID：transaction_id，事务id。最近一次修改当前数据的事务id</li><li>DB_ROLL_PTR（7Bytes）：回滚指针。该指针指向undo-Log中上次修改的旧数据地址。行数据的多版本</li></ul></li><li>Undo-log：Undo-log日志会存储旧版本数据组成一个单向链表。最新数据会插入到表头</li><li><strong>ReadView</strong>：当一个事务启动后，执行select时，MVCC就会生成一个ReadView读视图，该视图包含一下核心内容：<ul><li>creator_trx_id：创建当前视图的事务id</li><li>trx_ids：生成当前视图时，系统内活跃的事务ids列表</li><li>up_limit_id：活跃的事务id列表中最小的事务id</li><li>low_limit_id：生成当前视图时，系统为下一个事务分配的事务id</li></ul></li></ul><p>原理：</p><ul><li>当一个事务尝试改动某条数据时，会将原本表中的旧数据放入<code>Undo-log</code>日志中。</li><li>当一个事务尝试查询某条数据时，<code>MVCC</code>会生成一个<code>ReadView</code>快照。</li></ul><p>其中<code>Undo-log</code>主要实现数据的多版本，<code>ReadView</code>则主要实现多版本的并发控制。</p><p><img loading="lazy" alt="1669692809742" src="/assets/images/1669692809742-64f80c7934f7fff7480d7a55079ee170.png" width="875" height="598" class="img_ev3q"></p><p>如果<code>Undo-log</code>日志中的旧数据存在一个版本链时，此时会首先根据隐藏列<code>roll_ptr</code>找到链表头，然后依次遍历整个列表，从而检索到最合适的一条数据并返回。条件如下：</p><ul><li>旧版本的数据，其隐藏列<code>trx_id</code>不能在<code>ReadView.trx_ids</code>活跃事务列表中。<img loading="lazy" alt="1669693119746" src="/assets/images/1669693119746-5a8dee77c1c33c9d97f861bed59dec59.png" width="712" height="801" class="img_ev3q"><img loading="lazy" alt="1669704272375" src="/assets/images/1669704272375-bcdc9fddde1beb4a615a1533132cd595.png" width="701" height="625" class="img_ev3q"></li></ul><p>RC、RR不同级别下的MVCC机制
RC提交读，每次select都会创建一个ReadView
RR可重复读，只有第一次select时会创建一个ReadView</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="十全解mysql之死锁问题分析事务隔离与锁机制的底层原理剖析"><a target="_blank" href="/assets/files/MySQL之死锁问题分析-事务隔离与锁机制的底层原理剖析-19d41b59e76b5fbe331ab4b8b2340b19.pdf">(十)全解MySQL之死锁问题分析、事务隔离与锁机制的底层原理剖析</a><a class="hash-link" href="#十全解mysql之死锁问题分析事务隔离与锁机制的底层原理剖析" title="标题的直接链接">​</a></h3><p>Mysql死锁现象：</p><p><img loading="lazy" alt="1669791741431" src="/assets/images/1669791741431-00c97b2e83e8b78793a506a5586cd2d7.png" width="556" height="155" class="img_ev3q"></p><p><img loading="lazy" alt="1669791631903" src="data:image/png;base64,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" width="683" height="65" class="img_ev3q">
死锁解决：</p><ul><li><p>锁超时机制：事务/线程在等待锁时，超出一定时间后自动放弃等待并返回(50S)。
<strong>show</strong> variables <strong>like</strong> 'innodb_lock_wait_timeout'; </p></li><li><p>外力介入打破僵局：第三者介入，将死锁情况中的某个事务/线程强制结束，让其他事务继续执行。
死锁检测算法 - wait-for graph：算法被启用后，会要求<code>MySQL</code>收集两个信息：</p><ul><li><p>锁的信息链表：目前持有每个锁的事务是谁。</p></li><li><p>事务等待链表：阻塞的事务要等待的锁是谁。
<img loading="lazy" alt="1669793214122" src="/assets/images/1669793214122-373d4b324978b7a12534cc0058666cc9.png" width="695" height="770" class="img_ev3q"></p><p>出现死锁问题时，<code>MySQL</code>会选择哪个事务回滚呢？之前分析过，当一个事务在执行<code>SQL</code>更改数据时，都会记录在<code>Undo-log</code>日志中，<code>Undo</code>量越小的事务，代表它对数据的更改越少，同时回滚的代价最低，因此会选择<code>Undo</code>量最小的事务回滚（如若两个事务的<code>Undo</code>量相同，会选择回滚触发死锁的事务）。</p><p>死锁检测机制在<code>MySQL</code>后续的高版本中是默认开启的，但实际上死锁检测的开销不小，上面三个并发事务阻塞时，会对「事务等待链表、锁的信息链表」共计检索六次，那当阻塞的并发事务越来越多时，检测的效率也会呈线性增长。</p></li></ul></li></ul><p>避免死锁产生：</p><ul><li>把大事务变成小事务</li><li>减小锁的粒度</li><li>把较大、耗时较长的事务尽量防止特定时间执行</li></ul><p>锁机制的实现原理：</p><p>锁对象：结构信息
<img loading="lazy" alt="1669793342690" src="/assets/images/1669793342690-f661c578a04223aa45d8fb541a590e66.png" width="404" height="300" class="img_ev3q"></p><ul><li>锁的事务信息：当先的锁对象是由那个事务生成的，记录的是指针，指向一个具体的事务</li><li>索引的信息：行锁特有的信息。记录行锁的行数据属于那个索引、那个节点。</li><li>锁粒度信息：表锁，记录的是表的信息。行锁，记录行数据信息，行信息主要记录一下三个：<ul><li>Space ID：枷锁的行数据，所在表空间ID</li><li>PageNumber：所在页号</li><li>n_bits：使用的比特位，对于一页数据中，加了多少个锁</li></ul></li><li>锁类型信息：
<img loading="lazy" alt="1669793886185" src="/assets/images/1669793886185-c534ffd173edb84a950b71691a72a9cb.png" width="708" height="729" class="img_ev3q"><img loading="lazy" alt="1669793897161" src="/assets/images/1669793897161-00682137804eb6e532f829812b61c085.png" width="703" height="231" class="img_ev3q"></li><li>其他信息：这个所谓的其他信息，也就是指一些用于辅助锁机制的信息，比如之前死锁检测机制中的「事务等待链表、锁的信息链表」，每一个事务和锁的持有、等待关系，都会在这里存储，将所有的事务、锁连接起来，就形成了上述的两个链表。</li><li>锁的比特位：也可以说数据的比特位。如果查询出来2条数据，则会形成一个比特数组：0000，之所以是4比特位，是因为行锁中，间隙锁可以锁定无穷大、无穷小这两个间隙，即首位无穷小，末尾无穷大</li></ul><p>事务隔离机制底层实现</p><p><img loading="lazy" alt="1669795023864" src="/assets/images/1669795023864-8aac255e55823c40f9124db4f9fbeebb.png" width="564" height="340" class="img_ev3q"></p><p>RR级别解决了幻影读</p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="十一mysql日志篇之undo-logredo-logbin-log-"><a target="_blank" href="/assets/files/MySQL日志篇-70413c4f6adfce63c90bacb2c8fe49f1.pdf">(十一)MySQL日志篇之undo-log、redo-log、bin-log </a><a class="hash-link" href="#十一mysql日志篇之undo-logredo-logbin-log-" title="标题的直接链接">​</a></h3><ul><li><p>undo-log：撤销日志、回滚日志；当需要回滚事务时，直接用<code>Undo</code>旧记录覆盖表中修改过的新记录
<code>MySQL5.5</code>之前没有太多参数，如下：</p><ul><li><code>innodb_max_undo_log_size</code>：本地磁盘文件中，<code>Undo-log</code>的最大值，默认<code>1GB</code>。</li><li><code>innodb_rollback_segments</code>：指定回滚段的数量，默认为<code>1</code>个。</li></ul><p>除开上述两个参数外，其他参数基本上是在<code>MySQL5.6</code>才有的，如下：</p><ul><li><code>innodb_undo_directory</code>：指定<code>Undo-log</code>的存放目录，默认放在<code>.ibdata</code>文件中。</li><li><code>innodb_undo_logs</code>：指定回滚段的数量，默认为<code>128</code>个，也就是之前的<code>innodb_rollback_segments</code>。</li><li><code>innodb_undo_tablespaces</code>：指定<code>Undo-log</code>分成几个文件来存储，必须开启<code>innodb_undo_directory</code>参数。</li><li><code>innodb_undo_log_truncate</code>：是否开启<code>Undo-log</code>的在线压缩功能，即日志文件超过大小一半时自动压缩，默认<code>OFF</code>关闭。</li></ul><p>没错，在<code>MySQL5.5</code>版本以后，<code>Undo-log</code>日志支持单独存放，并且多出了几个参数可以调整<code>Undo-log</code>的区域。</p></li><li><p>redo-log：重做日志，用来实现数据的恢复。redo-log 和 undo-log 日志都是<code>InnoDB</code>引擎独有的。
当<code>MySQL</code>启动后就会在内存中创建一个<code>BufferPool</code>，运行过程中会将大量操作汇集在内存中进行，比如写入数据时，先写到内存中，然后由后台线程再刷写到磁盘。
因为数据写到内存后有丢失风险，这明显违背了事务<code>ACID</code>原则中的持久性，所以<code>Redo-log</code>的出现就是为了解决该问题，<code>Redo-log</code>是一种预写式日志，即在向内存写入数据前，会先写日志，当后续数据未被刷写到磁盘、<code>MySQL</code>崩溃时，就可以通过日志来恢复数据，确保所有提交的事务都会被持久化。
<img loading="lazy" alt="1669799797165" src="/assets/images/1669799797165-2c5b3aa6470d9ddb7a89fe1162052fc7.png" width="697" height="261" class="img_ev3q">
默认每次提交事务时都会刷盘</p><p>常用参数：</p><ul><li><code>innodb_flush_log_at_trx_commit</code>：设置<code>redo_log_buffer</code>的刷盘策略，默认每次提交事务都刷盘。</li><li><code>innodb_log_group_home_dir</code>：指定<code>redo-log</code>日志文件的保存路径，默认为<code>./</code>。</li><li><code>innodb_log_buffer_size</code>：指定<code>redo_log_buffer</code>缓冲区的大小，默认为<code>16MB</code>。</li><li><code>innodb_log_files_in_group</code>：指定<code>redo</code>日志的磁盘文件个数，默认为<code>2</code>个。</li><li><code>innodb_log_file_size</code>：指定<code>redo</code>日志的每个磁盘文件的大小限制，默认为<code>48MB</code>。</li></ul></li><li><p>bin-log变更日志：也被称之为二进制日志，主要是记录所有对数据库表结构变更和表数据修改的操作，对于<code>select、show</code>这类读操作并不会记录。
<code>MySQL-Server</code>会给每一条工作线程，都分配一个<code>bin_log_buffer</code>，而并不是放在共享缓冲区中</p><p>在<code>bin-log</code>的本地文件中，存储的日志记录共有<code>Statment、Row、Mixed</code>三种格式</p><p>对于<code>Redo-log、Bin-log</code>两者的区别，主要可以从四个维度上来说：</p><ul><li>①生效范围不同，<code>Redo-log</code>是<code>InnoDB</code>专享的，<code>Bin-log</code>是所有引擎通用的。</li><li>②写入方式不同，<code>Redo-log</code>是用两个文件循环写，而<code>Bin-log</code>是不断创建新文件追加写。</li><li>③文件格式不同，<code>Redo-log</code>中记录的都是变更后的数据，而<code>Bin-log</code>会记录变更<code>SQL</code>语句。</li><li>④使用场景不同，<code>Redo-log</code>主要实现故障情况下的数据恢复（数据一致），<code>Bin-log</code>则用于数据灾备、同步。</li></ul><p>bin-log相关的参数</p><ul><li><code>log_bin</code>：是否开启<code>bin-log</code>日志，默认<code>ON</code>开启，表示会记录变更<code>DB</code>的操作。</li><li><code>log_bin_basename</code>：设置<code>bin-log</code>日志的存储目录和文件名前缀，默认为<code>./bin.0000x</code>。</li><li><code>log_bin_index</code>：设置<code>bin-log</code>索引文件的存储位置，因为本地有多个日志文件，需要用索引来确定目前该操作的日志文件。</li><li><code>binlog_format</code>：指定<code>bin-log</code>日志记录的存储方式，可选<code>Statment、Row、Mixed</code>。</li><li><code>max_binlog_size</code>：设置<code>bin-log</code>本地单个文件的最大限制，最多只能调整到<code>1GB</code>。</li><li><code>binlog_cache_size</code>：设置为每条线程的工作内存，分配多大的<code>bin-log</code>缓冲区。</li><li><code>sync_binlog</code>：控制<code>bin-log</code>日志的刷盘频率。</li><li><code>binlog_do_db</code>：设置后，只会收集指定库的<code>bin-log</code>日志，默认所有库都会记录。</li></ul><p>两阶段提交：是指<code>Redo-log</code>分两次写入
<img loading="lazy" alt="两阶段提交" src="/assets/images/c02ced87e3ab4699a7349d54b54c3103_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0-429bbf5975b8633d5602665ffe72d8b8.webp" width="785" height="542" class="img_ev3q">
如果只写一次：</p><ul><li>先写bin-log：写完bin-log后，redo-log没有写。主机没有该事务信息，所以不会恢复，
而从节点同步时是拿bin-log同步的。所以主节点会比从节点少一条数据</li><li>先写redo-log：写完redo-log后，bin-log没有写。主机有该事务信息，会恢复，
而从节点同步时是拿bin-log同步的。所以主节点会比从节点多一条数据</li></ul><p>设置成两阶段提交后，整个执行过程有三处崩溃点：</p><ul><li><code>redo-log(prepare)</code>：在写入准备状态的<code>redo</code>记录时宕机，事务还未提交，不会影响一致性。</li><li><code>bin-log</code>：在写<code>bin</code>记录时崩溃，重启后会根据<code>redo</code>记录中的事务<code>ID</code>，回滚前面已写入的数据。</li><li><code>redo-log(commit)</code>：在<code>bin-log</code>写入成功后，写<code>redo(commit)</code>记录时崩溃，因为<code>bin-log</code>中已经写入成功了，所以从机也可以同步数据，因此重启时直接再次提交事务，写入一条<code>redo(commit)</code>记录即可。</li></ul><p>通过这种两阶段提交的方案，就能够确保<code>redo-log、bin-log</code>两者的日志数据是相同的，<code>bin-log</code>中有的主机再恢复，如果<code>bin-log</code>没有则直接回滚主机上写入的数据，确保整个数据库系统的数据一致性。</p></li><li><p>其他日志：`</p><ul><li><code>error-log</code>：<code>MySQL</code>线上<code>MySQL</code>由于非外在因素（断电、硬件损坏...）导致崩溃时，辅助线上排错的日志。</li><li><code>slow-log</code>：系统响应缓慢时，用于定位问题<code>SQL</code>的日志，其中记录了查询时间较长的<code>SQL</code>。</li><li><code>general log</code>即查询日志。<code>MySQL</code>会向其中写入所有收到的查询命令，如<code>select、show</code>等，同时要注意：无论<code>SQL</code>的语法正确还是错误、也无论<code>SQL</code>执行成功还是失败，<code>MySQL</code>都会将其记录下来。</li><li><code>relay-log</code>：搭建<code>MySQL</code>高可用热备架构时，用于同步数据的辅助日志。</li></ul></li></ul><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="十二mysql之内存篇---掘金pdf"><a target="_blank" href="/assets/files/MySQL之内存篇-6c9080ee596176deba646fa872f7c73e.pdf">(十二)MySQL之内存篇 - 掘金.pdf</a><a class="hash-link" href="#十二mysql之内存篇---掘金pdf" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql">SQL<a class="hash-link" href="#sql" title="标题的直接链接">​</a></h3><ul><li>DML：数据操作语言，操作数据库的数据，增删改</li><li>DQL：数据查询语言，查询数据库的数据</li><li>DDL：数据定义语言，定义数据库库、表、列等</li><li>DCL：数据控制语言：用了定义访问权限和安全级别</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="库">库<a class="hash-link" href="#库" title="标题的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="建库">建库<a class="hash-link" href="#建库" title="标题的直接链接">​</a></h5><blockquote><p>create database d1 DEFAULT CHARACTER SET UTF8;</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="删库">删库<a class="hash-link" href="#删库" title="标题的直接链接">​</a></h5><blockquote><p> drop database d1;</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="查库">查库<a class="hash-link" href="#查库" title="标题的直接链接">​</a></h5><blockquote><p>show databases;</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="使用数据库">使用数据库<a class="hash-link" href="#使用数据库" title="标题的直接链接">​</a></h5><blockquote><p>user d1;</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="表">表<a class="hash-link" href="#表" title="标题的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="创建表">创建表<a class="hash-link" href="#创建表" title="标题的直接链接">​</a></h5><blockquote><p>create table t_door(</p><p>id int primary key  auto_increment,</p><p>door_name varchar(100),</p><p>]tel varchar(50)</p><p>)</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="修改表">修改表<a class="hash-link" href="#修改表" title="标题的直接链接">​</a></h5><blockquote><p>alter table t_door add column price NUMERIC(7,2);</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="删除表">删除表<a class="hash-link" href="#删除表" title="标题的直接链接">​</a></h5><blockquote><p>drop table t_door;</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="查看表">查看表<a class="hash-link" href="#查看表" title="标题的直接链接">​</a></h5><blockquote><p>show tables;</p><p>desc t_door;   //查看表结构</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="数据">数据<a class="hash-link" href="#数据" title="标题的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="插入数据">插入数据<a class="hash-link" href="#插入数据" title="标题的直接链接">​</a></h5><blockquote><p>insert into t_door values(null,"1",66.50);</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="查询记录">查询记录<a class="hash-link" href="#查询记录" title="标题的直接链接">​</a></h5><blockquote><p>select * from t_door;</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="修改记录">修改记录<a class="hash-link" href="#修改记录" title="标题的直接链接">​</a></h5><blockquote><p> update t_door set tel = 222 where id = 1;</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="删除记录">删除记录<a class="hash-link" href="#删除记录" title="标题的直接链接">​</a></h5><blockquote><p>delete from t_door where id = 2;</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="排序">排序<a class="hash-link" href="#排序" title="标题的直接链接">​</a></h5><blockquote><p>select *from t_door order by id DESC/ASC;</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="聚合">聚合<a class="hash-link" href="#聚合" title="标题的直接链接">​</a></h5><blockquote><p>select count(*)totalCount from  t_door;</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sql优化">SQL优化<a class="hash-link" href="#sql优化" title="标题的直接链接">​</a></h4><blockquote><p>索引：</p><p><img loading="lazy" alt="1668132054892" src="/assets/images/1668132054892-5f1d4b7828e8ac213af7e56e7de28593.png" width="699" height="684" class="img_ev3q"></p><ul><li>最左匹配原则：最左优先，以最左边的为起点任何连续的索引都能匹配上。同时遇到范围查询(&gt;、&lt;、between、like)就会停止匹配。</li><li></li></ul></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="数据类型">数据类型<a class="hash-link" href="#数据类型" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="字符">字符<a class="hash-link" href="#字符" title="标题的直接链接">​</a></h4><blockquote><p>char：定长字符串（最大255）；不足使用空格填充。查询速度快单浪费空间</p><p>varchar：边长字符串（最大16383）：查询稍慢但不占用空间</p><p>text：长文本(Mysql：v8  65535byte)</p><p>blob：二进制形式的长文本(Mysql：v8  65535byte)</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="数字">数字<a class="hash-link" href="#数字" title="标题的直接链接">​</a></h4><blockquote><p>tinyint,int整数类型</p><p>float,double小数类型</p><p>numberic(5,2) decimal(5,2)—也可以表示小数,表示总共5位,其中可以有两位小数</p><p>decimal和numeric表示精确的整数数字</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="日期">日期<a class="hash-link" href="#日期" title="标题的直接链接">​</a></h4><blockquote><p>date 包含年月日</p><p>time时分秒</p><p>datetime包含年月日和时分秒</p><p>timestamp时间戳，不是日期，而是从1970年1月1日到指定日期的毫秒数</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="图片">图片<a class="hash-link" href="#图片" title="标题的直接链接">​</a></h4><blockquote><p> blob 二进制数据，可以存放图片、声音，容量4g。早期有这样的设计。但其缺点非常明显，数据库庞大，备份缓慢，这些内容去备份多份价值不大。同时数据库迁移时过大，迁移时间过久。所以目前主流都不会直接存储这样的数据，而只存储其访问路径，文件则存放在磁盘上。</p></blockquote><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="字段约束">字段约束<a class="hash-link" href="#字段约束" title="标题的直接链接">​</a></h3><blockquote><p>查询约束：</p><p>SELECT *FROM information_schema.TABLE_CONSTRAINTS</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="主键">主键<a class="hash-link" href="#主键" title="标题的直接链接">​</a></h4><blockquote><p>主键约束：如果为一个列添加了主键约束，那么这个列就是主键，主键的特点是唯一且不能为空。通常情况下，每张表都会有主键。</p><p>create  table d1 (</p><p>id int primary key auto_increment</p><p>);</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="非空约束">非空约束<a class="hash-link" href="#非空约束" title="标题的直接链接">​</a></h4><blockquote><p>非空约束：如果为一个列添加了非空约束，那么这个列的值就不能为空，但可以重复。</p><p>password varchar(50) not null</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="唯一约束">唯一约束<a class="hash-link" href="#唯一约束" title="标题的直接链接">​</a></h4><blockquote><p>唯一约束：如果为一个列添加了唯一约束，那么这个列的值就必须是唯一的（即不能重复），但可以为空。</p><p>username varchar(50) unique</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="默认约束">默认约束<a class="hash-link" href="#默认约束" title="标题的直接链接">​</a></h4><blockquote><p>给某个字段某列指定默认值，一旦设置默认值，在插入数据时，如果此字段没有显式赋值，则赋值为默认值</p><p>sex char(1) default '0'</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="函数">函数<a class="hash-link" href="#函数" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="字符串函数">字符串函数<a class="hash-link" href="#字符串函数" title="标题的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="lower">lower()<a class="hash-link" href="#lower" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="upper">upper()<a class="hash-link" href="#upper" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="length">length()<a class="hash-link" href="#length" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="substr">substr()<a class="hash-link" href="#substr" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="concat">concat()<a class="hash-link" href="#concat" title="标题的直接链接">​</a></h5><p>replace()</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="ifnull">ifnull()<a class="hash-link" href="#ifnull" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="round--ceil--floor">round() &amp; ceil() &amp; floor()<a class="hash-link" href="#round--ceil--floor" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="uuid">uuid()<a class="hash-link" href="#uuid" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="year--month--day">year() &amp; month() &amp; day()<a class="hash-link" href="#year--month--day" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="ascii">ascii()<a class="hash-link" href="#ascii" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="conv">conv()<a class="hash-link" href="#conv" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="bin">bin()<a class="hash-link" href="#bin" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="oct">oct()<a class="hash-link" href="#oct" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="hex">hex()<a class="hash-link" href="#hex" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="length-1">length()<a class="hash-link" href="#length-1" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="locate">locate()<a class="hash-link" href="#locate" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="position">position()<a class="hash-link" href="#position" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="ldap">ldap()<a class="hash-link" href="#ldap" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="rdap">rdap()<a class="hash-link" href="#rdap" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="left">left()<a class="hash-link" href="#left" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="right">right()<a class="hash-link" href="#right" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="substring">substring()<a class="hash-link" href="#substring" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="substring_index">substring_index()<a class="hash-link" href="#substring_index" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="ltrim">ltrim()<a class="hash-link" href="#ltrim" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="rtrim">rtrim()<a class="hash-link" href="#rtrim" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="trim">trim()<a class="hash-link" href="#trim" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="space">space()<a class="hash-link" href="#space" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="replace">replace()<a class="hash-link" href="#replace" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="repeat">repeat()<a class="hash-link" href="#repeat" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="reverse">reverse()<a class="hash-link" href="#reverse" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="insert">insert()<a class="hash-link" href="#insert" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="elt">elt()<a class="hash-link" href="#elt" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="field">field()<a class="hash-link" href="#field" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="find_in_set">find_in_set()<a class="hash-link" href="#find_in_set" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="make_set">make_set()<a class="hash-link" href="#make_set" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="export_set">export_set()<a class="hash-link" href="#export_set" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="lower-1">lower()<a class="hash-link" href="#lower-1" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="upper-1">upper()<a class="hash-link" href="#upper-1" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="load_file">load_file()<a class="hash-link" href="#load_file" title="标题的直接链接">​</a></h5><h4 class="anchor anchorWithStickyNavbar_LWe7" id="数学函数">数学函数<a class="hash-link" href="#数学函数" title="标题的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="abs">abs()<a class="hash-link" href="#abs" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="sign">sign()<a class="hash-link" href="#sign" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="mod">mod()<a class="hash-link" href="#mod" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="floor">floor()<a class="hash-link" href="#floor" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="feiling">feiling()<a class="hash-link" href="#feiling" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="round">round()<a class="hash-link" href="#round" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="exp">exp()<a class="hash-link" href="#exp" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="log">log()<a class="hash-link" href="#log" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="log10">log10()<a class="hash-link" href="#log10" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="power">power()<a class="hash-link" href="#power" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="sqrt">sqrt()<a class="hash-link" href="#sqrt" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="pi">pi()<a class="hash-link" href="#pi" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="cos">cos()<a class="hash-link" href="#cos" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="sin">sin()<a class="hash-link" href="#sin" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="tan">tan()<a class="hash-link" href="#tan" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="acos">acos()<a class="hash-link" href="#acos" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="asin">asin()<a class="hash-link" href="#asin" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="atan">atan()<a class="hash-link" href="#atan" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="atan2">atan2()<a class="hash-link" href="#atan2" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="cot">cot()<a class="hash-link" href="#cot" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="rand">rand()<a class="hash-link" href="#rand" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="degrees">degrees()<a class="hash-link" href="#degrees" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="radians">radians()<a class="hash-link" href="#radians" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="truncate">truncate()<a class="hash-link" href="#truncate" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="least">least()<a class="hash-link" href="#least" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="greatest">greatest()<a class="hash-link" href="#greatest" title="标题的直接链接">​</a></h5><hr><h4 class="anchor anchorWithStickyNavbar_LWe7" id="日期时间函数">日期时间函数<a class="hash-link" href="#日期时间函数" title="标题的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="dayofweek">dayofweek()<a class="hash-link" href="#dayofweek" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="weekday">weekday()<a class="hash-link" href="#weekday" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="dayofmonth">dayofmonth()<a class="hash-link" href="#dayofmonth" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="dayofyear">dayofyear()<a class="hash-link" href="#dayofyear" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="month">month()<a class="hash-link" href="#month" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="dayname">dayname()<a class="hash-link" href="#dayname" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="monthname">monthname()<a class="hash-link" href="#monthname" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="quarter">quarter()<a class="hash-link" href="#quarter" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="week">week()<a class="hash-link" href="#week" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="year">year()<a class="hash-link" href="#year" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="hour">hour()<a class="hash-link" href="#hour" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="minute">minute()<a class="hash-link" href="#minute" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="second">second()<a class="hash-link" href="#second" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="period_add">period_add()<a class="hash-link" href="#period_add" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="period_diff">period_diff()<a class="hash-link" href="#period_diff" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="adddate">adddate()<a class="hash-link" href="#adddate" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="subdate">subdate()<a class="hash-link" href="#subdate" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="extract">extract()<a class="hash-link" href="#extract" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="to_days">to_days()<a class="hash-link" href="#to_days" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="from_days">from_days()<a class="hash-link" href="#from_days" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="date_format">date_format()<a class="hash-link" href="#date_format" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="time_format">time_format()<a class="hash-link" href="#time_format" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="curdate">curdate()<a class="hash-link" href="#curdate" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="curtime">curtime()<a class="hash-link" href="#curtime" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="now">now()<a class="hash-link" href="#now" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="unix_timestamp">unix_timestamp()<a class="hash-link" href="#unix_timestamp" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="from_unixtime">from_unixtime()<a class="hash-link" href="#from_unixtime" title="标题的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="sec_to_time">sec_to_time()<a class="hash-link" href="#sec_to_time" title="标题的直接链接">​</a></h5><blockquote><p>select sec_to_time(2378);   </p><p>以'hh:mm:ss'或hhmmss格式返回秒数转成的time值(根据返回值所处上下文是字符串或数字) </p><p> '00:39:38'   </p><p>select sec_to_time(2378) + 0;  </p><p>3938 </p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="time_to_sex">time_to_sex()<a class="hash-link" href="#time_to_sex" title="标题的直接链接">​</a></h5><blockquote><p>select time_to_sec('22:23:00'); </p><p>返回time值有多少秒   </p><p>80580 </p></blockquote><hr><h4 class="anchor anchorWithStickyNavbar_LWe7" id="转换函数">转换函数<a class="hash-link" href="#转换函数" title="标题的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="cast">cast()<a class="hash-link" href="#cast" title="标题的直接链接">​</a></h5><blockquote><p>用法：cast(字段 as 数据类型) <!-- -->[当然是否可以成功转换，还要看数据类型强制转化时注意的问题]</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="convert">convert()<a class="hash-link" href="#convert" title="标题的直接链接">​</a></h5><blockquote><p>用法：convert(字段,数据类型)</p><ul><li>binary：二进制类型；</li><li>char：字符类型；</li><li>date：日期类型；</li><li>time：时间类型；</li><li>datetime：日期时间类型；</li><li>decimal：浮点型；</li><li>signed：整型；</li><li>unsigned：无符号整型。</li></ul></blockquote><h1>Server</h1><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="docker">docker<a class="hash-link" href="#docker" title="标题的直接链接">​</a></h2><blockquote><p>Docker是一个用于开发，交付和运行应用程序的开放平台。Docker使您能够将应用程序和基础框架分开，从而可以快速交付软件。借助Docker，您可以与管理应用程序相同的方式管理基础架构。通过利用Docker的方法快速交付，测试和部署代码，您可以大大减少编写代码和在生产环境中运行代码之间的延迟。</p><p>容器非常适合持续集成和持续交付（CI / CD）工作流程</p><p>Docker应用场景</p><ul><li>web应用的自动化打包和发布</li><li>自动化测试和持续集成、发布</li><li>在服务型环境中部署和调整数据库和其他的后台应用</li><li>从头编译或者扩展现有的OpenShift或Cloud Foundry</li></ul></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="架构">架构<a class="hash-link" href="#架构" title="标题的直接链接">​</a></h4><ul><li>镜像（Image）：相当于是一个root文件系统。比如官方镜像Ubuntu：16.04就包含了完整的一套ubuntu16.01最小的文件系统。</li><li>容器（Container）：镜像和容器的关系，就像是面向对象程序设计中的类和实例一样，镜像是静态的定义，容器是镜像运行的实体。容器可以被创建、启动、停止、删除、暂停等</li><li>仓库（Repository）：仓库可以看成代码控制中心，用来存储镜像</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装">安装<a class="hash-link" href="#安装" title="标题的直接链接">​</a></h4><blockquote><p>CentOS：</p><p><strong>存储库安装</strong></p><ul><li><p>卸载旧版本</p><div class="language-tcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sudo yum remove docker \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  docker-client \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  docker-client-latest \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  docker-common \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  docker-latest \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  docker-latest-logrotate \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  docker-logrotate \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  docker-engine</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>卸载Docker引擎</p><div class="language-tcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">卸载 Docker Engine、CLI、Containerd 和 Docker Compose 软件包：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sudo yum remove docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">删除所有映像、容器和卷：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sudo rm -rf /var/lib/docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sudo rm -rf /var/lib/containerd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><ul><li><p>设置Docker存储库</p><div class="language-tcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sudo yum install -y yum-utils</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">官方源地址</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sudo yum-config-manager \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --add-repo \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">阿里云</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sudo yum-config-manager \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --add-repo \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">清华大学源</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sudo yum-config-manager \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --add-repo \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>安装Docker引擎(Docker Engine-Community)</p><p>默认安装最新版本</p><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">### 查看可用版本</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">yum list docker-ce --showduplicates | sort -r</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3:20.10.8-3.el7</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">VERSION = 20.10.8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>安装</p><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sudo yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">指定版本</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sudo yum install docker-ce-VERSION docker-ce-cli-VERSION containerd.io</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p><strong>包安装</strong></p><p><a href="https://download.docker.com/linux/centos/" target="_blank" rel="noopener noreferrer">前往</a>并选择您的 CentOS 版本。然后浏览<code>x86_64/stable/Packages/</code> 并下载<code>.rpm</code>要安装的 Docker 版本的文件。</p><p>安装</p><p> sudo yum install /path/to/package.rpm</p><p><strong>脚本安装</strong></p><p>[<a href="https://get.docker.com/" target="_blank" rel="noopener noreferrer">Docker 在https://get.docker.com/</a>提供了一个方便的脚本， 以非交互方式将 Docker 安装到开发环境中。不建议将便利脚本用于生产环境，但它对于创建适合您的需求的配置脚本很有用。另请参阅 <a href="https://docs.docker.com/engine/install/centos/#install-using-the-repository" target="_blank" rel="noopener noreferrer">使用存储库</a>安装步骤以了解使用包存储库安装的安装步骤。该脚本的源代码是开源的，可以 <a href="https://github.com/docker/docker-install" target="_blank" rel="noopener noreferrer"><code>docker-install</code>在 GitHub 上的存储库中找到</a>。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">curl -fsSL https://get.docker.com -o get-docker.sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ sudo sh get-docker.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="命令">命令<a class="hash-link" href="#命令" title="标题的直接链接">​</a></h4><blockquote><p>启动：systemctl start docker</p><p>运行HelloWorld：sudo docker run hello-world</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="容器使用">容器使用<a class="hash-link" href="#容器使用" title="标题的直接链接">​</a></h4><blockquote><p>拉取ubuntu镜像：docker pull ubuntu</p><p>启动容器并进入容器：docker  run  -it --name  ubuntu /bin/bash</p><ul><li><strong>-i</strong>: 交互式操作。</li><li><strong>-t</strong>: 终端。</li><li><strong>ubuntu</strong>: ubuntu 镜像。</li><li><strong>/bin/bash</strong>：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 /bin/bash。</li><li>容器名称</li></ul><p>退出容器：exit 退出容器并停止容器   </p><p>退出容器：docker exec -it 243c32535da7 /bin/bash<br>
<!-- -->Ctrl + Q + P</p><p>查看所有容器：docker ps -a</p><p>启动一个已经停止的容器：docker start b750bbbcfd88 </p><p>后台运行：docker run -itd --name ubuntu-test ubuntu /bin/bash</p><p>停止容器：docker stop b750bbbcfd88 </p><p>重启容器：docker restart b750bbbcfd88 </p><p>进入容器：docker attach b750bbbcfd88 </p><p>导出容器：docker export 1e560fca3906 &gt; ubuntu.tar</p><p>导入容器：cat ubuntu.tar | docker import  - newubuntu:v2</p><p>删除容器：docker rm -f  b750bbbcfd88 </p><p>删除所有已经停止的容器：docker container prune</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="运行一个web应用">运行一个web应用<a class="hash-link" href="#运行一个web应用" title="标题的直接链接">​</a></h4><blockquote><p>拉取镜像：docker pull training/webapp</p><p>启动容器：docker run -d -P training/webapp python app.py</p><ul><li><strong>-d:</strong>让容器在后台运行。</li><li><strong>-P:</strong>将容器内部使用的网络端口<strong>随机</strong>映射到我们使用的主机上。</li><li>0.0.0.0:32769-&gt;5000/tcp   32769主机端口  5000容器端口</li></ul><p>指定主机端口：docker run -d -p 80:5000 training/webapp python app.py</p><p>查看日志：docker logs -f  awesome_nobel</p><p>查看容器进程：docker top awesome_nobel</p><p>查看容器详细信息：docker inspect  awesome_nobel</p><p>查看最后一次创建的容器：docker ps -l</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="镜像使用">镜像使用<a class="hash-link" href="#镜像使用" title="标题的直接链接">​</a></h4><blockquote><p>查询镜像：docker images</p><p><a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">查找镜像</a>：docker search httpd</p><p>拉取镜像：docker pull httpd</p><p>删除镜像：docker rmi hello-world</p><p>打包容器：docker commit -m="has update" -a="runoob" e218edb10161 runoob/ubuntu:v2</p><ul><li><strong>-m:</strong> 提交的描述信息</li><li><strong>-a:</strong> 指定镜像作者</li><li><strong>e218edb10161：</strong>容器 ID</li><li><strong>runoob/ubuntu:v2:</strong> 指定要创建的目标镜像名</li></ul><p>构建镜像：docker build -t runoob/centos:6.7 .</p><ul><li><strong>-t</strong> ：指定要创建的目标镜像名</li><li><strong>.</strong> ：Dockerfile 文件所在目录，可以指定Dockerfile 的绝对路径</li></ul><p>添加镜像标签：docker tag 860c279d2fec runoob/centos:dev</p><p>删除镜像（标签）：docker -rmi  runoob/centos:dev</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="容器连接">容器连接<a class="hash-link" href="#容器连接" title="标题的直接链接">​</a></h4><blockquote><p>容器中可以运行一些网络应用，要让外部也可以访问这些应用，可以通过 -P 或 -p 参数来指定端口映射。</p><ul><li><strong>-P :</strong>是容器内部端口<strong>随机</strong>映射到主机的端口。</li><li><strong>-p :</strong> 是容器内部端口绑定到<strong>指定</strong>的主机端口。</li></ul><p>新建网络：docker network create -d bridge test-net</p><p><strong>-d</strong>：参数指定 Docker 网络类型，有 bridge、overlay。</p><p>其中 overlay 网络类型用于 Swarm mode，在本小节中你可以忽略它。</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置-dns">配置 DNS<a class="hash-link" href="#配置-dns" title="标题的直接链接">​</a></h4><blockquote><p>我们可以在宿主机的 /etc/docker/daemon.json 文件中增加以下内容来设置全部容器的 DNS：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">"dns"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">"114.114.114.114"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">"8.8.8.8"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>配置完，需要重启 docker 才能生效。</p><p>查看容器的 DNS 是否生效可以使用以下命令，它会输出容器的 DNS 信息：docker run -it --rm  ubuntu  cat etc/resolv.conf</p><p>指定的容器设置 DNS：docker run -it --rm -h host_ubuntu  --dns=114.114.114.114 --dns-search=test.com ubuntu</p><ul><li><p><strong>--rm</strong>：容器退出时自动清理容器内部的文件系统。</p></li><li><p><strong>-h HOSTNAME 或者 --hostname=HOSTNAME</strong>： 设定容器的主机名，它会被写到容器内的 /etc/hostname 和 /etc/hosts。</p></li><li><p><strong>--dns=IP_ADDRESS</strong>： 添加 DNS 服务器到容器的 /etc/resolv.conf 中，让容器用这个服务器来解析所有不在 /etc/hosts 中的主机名。</p></li><li><p><strong>--dns-search=DOMAIN</strong>： 设定容器的搜索域，当设定搜索域为 .example.com 时，在搜索一个名为 host 的主机时，DNS 不仅搜索 host，还会搜索 host.example.com。</p></li></ul></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="仓库管理">仓库管理<a class="hash-link" href="#仓库管理" title="标题的直接链接">​</a></h4><blockquote><p>仓库（Repository）是集中存放镜像的地方。以下介绍一下 <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker Hub</a>。当然不止 docker hub，只是远程的服务商不一样，操作都是一样的。</p><p>登录：docker login </p><p>退出：docker logout</p><p>查找官方（公共）镜像：docker search ubuntu</p><p>拉取：docker pull ubuntu</p><p>dckr_pat_L2aHULFHJiy4LbGh-47iJV1XA2k</p><p>推送镜像：</p><ol><li>修改镜像标签：docker tag ubuntu:v1  账号/ubuntuv1</li><li>推送：docker push  账号/ubuntuv1</li></ol></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="dockerfile">Dockerfile<a class="hash-link" href="#dockerfile" title="标题的直接链接">​</a></h4><blockquote><p>Dockerfile 是一个用来构建镜像的文本文件</p><div class="language-tcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">FROM nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN echo '这是一个本地构建的nginx镜像' &gt; /usr/share/nginx/html/index.html</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>FROM：定制的镜像都是基于 FROM 的镜像，这里的 nginx 就是定制需要的基础镜像。后续的操作都是基于 nginx。</p></li><li><p>RUN：用于执行后面跟着的命令行命令。有以下俩种格式：</p></li></ul><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">RUN &lt;命令行命令&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># &lt;命令行命令&gt; 等同于，在终端操作的 shell 命令。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN ["可执行文件", "参数1", "参数2"]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 例如：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># RUN ["./test.php", "dev", "offline"] 等价于 RUN ./test.php dev offline</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>注意</strong>：Dockerfile 的指令每执行一次都会在 docker 上新建一层。所以过多无意义的层，会造成镜像膨胀过大。例如：</p><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">FROM centos</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN yum -y install wget</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN wget -O redis.tar.gz "http://download.redis.io/releases/redis-5.0.3.tar.gz"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN tar -xvf redis.tar.gz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">以上执行会创建 3 层镜像。可简化为以下格式：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FROM centos</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN yum -y install wget \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&amp;&amp; wget -O redis.tar.gz "http://download.redis.io/releases/redis-5.0.3.tar.gz" \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&amp;&amp; tar -xvf redis.tar.gz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">如上，以 &amp;&amp; 符号连接命令，这样执行后，只会创建 1 层镜像。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>上下文路径：. 是上下文路径；指 docker 在构建镜像，有时候想要使用到本机的文件（比如复制），docker build 命令得知这个路径后，会将路径下的所有内容打包。
<strong>注意</strong>：上下文路径下不要放无用的文件，因为会一起打包发送给 docker 引擎，如果文件过多会造成过程缓慢。</p></li><li><p>COPY：复制指令，从上下文目录中复制文件或者目录到容器里指定路径。</p><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">支持通配符</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY hom* /mydir/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">COPY hom?.txt /mydir/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>ADD：ADD 指令和 COPY 的使用格类似（同样需求下，官方推荐使用 COPY）。功能也类似，不同之处如下：</p><ul><li>ADD 的优点：在执行 &lt;源文件&gt; 为 tar 压缩文件的话，压缩格式为 gzip, bzip2 以及 xz 的情况下，会自动复制并解压到 &lt;目标路径&gt;。</li><li>ADD 的缺点：在不解压的前提下，无法复制 tar 压缩文件。会令镜像构建缓存失效，从而可能会令镜像构建变得比较缓慢。具体是否使用，可以根据是否需要自动解压来决定。</li></ul></li><li><p>CMD：类似于 RUN 指令，用于运行程序，但二者运行的时间点不同:</p><ul><li>RUN 是在 docker build。</li><li>CMD 在docker run 时运行。</li></ul><p><strong>注意</strong>：如果 Dockerfile 中如果存在多个 CMD 指令，仅最后一个生效。</p><p>格式：</p><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">CMD &lt;shell 命令&gt; </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CMD ["&lt;可执行文件或命令&gt;","&lt;param1&gt;","&lt;param2&gt;",...] </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CMD ["&lt;param1&gt;","&lt;param2&gt;",...]  # 该写法是为 ENTRYPOINT 指令指定的程序提供默认参数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">推荐使用第二种格式，执行过程比较明确。第一种格式实际上在运行的过程中也会自动转换成第二种格式运行，并且默认可执行文件是 sh。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>ENTRYPOINT：类似于 CMD 指令，但其不会被 docker run 的命令行参数指定的指令所覆盖，而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序。</p><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">优点：在执行 docker run 的时候可以指定 ENTRYPOINT 运行所需的参数。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">注意：如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生效。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">格式</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENTRYPOINT ["&lt;executeable&gt;","&lt;param1&gt;","&lt;param2&gt;",...]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">可以搭配 CMD 命令使用：一般是变参才会使用 CMD ，这里的 CMD 等于是在给 ENTRYPOINT 传参，以下示例会提到。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>示例：</p><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">假设已通过 Dockerfile 构建了 nginx:test 镜像：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">FROM nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENTRYPOINT ["nginx", "-c"] # 定参</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CMD ["/etc/nginx/nginx.conf"] # 变参 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1、不传参运行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run  nginx:test</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">容器内会默认运行以下命令，启动主进程。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nginx -c /etc/nginx/nginx.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2、传参运行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ docker run  nginx:test -c /etc/nginx/new.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">容器内会默认运行以下命令，启动主进程(/etc/nginx/new.conf:假设容器内已有此文件)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nginx -c /etc/nginx/new.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>ENV：设置环境变量，定义了环境变量，那么在后续的指令中，就可以使用这个环境变量。</p><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">格式：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENV &lt;key&gt; &lt;value&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENV &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENV NODE_VERSION 7.2.0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RUN curl -SLO "https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz" \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&amp;&amp; curl -SLO "https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">${variable:-word}表示如果variable设置，则结果将是该值。如果variable未设置然后word将是结果。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">${variable:+word}表示如果variable然后设置word将是结果，否则结果为空字符串。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>ARG：构建参数，与 ENV 作用一致。不过作用域不一样。ARG 设置的环境变量仅对 Dockerfile 内有效，也就是说只有 docker build 的过程中有效，构建好的镜像内不存在此环境变量。</p><p>构建命令 docker build 中可以用 --build-arg &lt;参数名&gt;=&lt;值&gt; 来覆盖。</p></li><li><p>VOLUME：定义匿名数据卷。在启动容器时忘记挂载数据卷，会自动挂载到匿名卷。</p><ul><li><p>避免重要的数据，因容器重启而丢失，这是非常致命的。</p></li><li><p>避免容器不断变大。</p><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">格式</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">VOLUME ["&lt;路径1&gt;", "&lt;路径2&gt;"...]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">VOLUME &lt;路径&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">在启动容器 docker run 的时候，我们可以通过 -v 参数修改挂载点。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p>EXPORT：仅仅只是声明端口。</p></li><li><p>WORKDIR：指定工作目录。用 WORKDIR 指定的工作目录，会在构建镜像的每一层中都存在。（WORKDIR 指定的工作目录，必须是提前创建好的）。</p><p>docker build 构建镜像过程中的，每一个 RUN 命令都是新建的一层。只有通过 WORKDIR 创建的目录才会一直存在。</p></li><li><p>USER：用于指定执行后续命令的用户和用户组，这边只是切换后续命令执行的用户（用户和用户组必须提前已经存在）。</p></li><li><p>HEALTHCHECK：用于指定某个程序或者指令来监控 docker 容器服务的运行状态。</p><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">HEALTHCHECK [选项] CMD &lt;命令&gt;：设置检查容器健康状况的命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">HEALTHCHECK NONE：如果基础镜像有健康检查指令，使用这行可以屏蔽掉其健康检查指令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">HEALTHCHECK [选项] CMD &lt;命令&gt; : 这边 CMD 后面跟随的命令使用，可以参考 CMD 的用法。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>ONBUILD：用于延迟构建命令的执行。简单的说，就是 Dockerfile 里用 ONBUILD 指定的命令，在本次构建镜像的过程中不会执行（假设镜像为 test-build）。当有新的 Dockerfile 使用了之前构建的镜像 FROM test-build ，这时执行新镜像的 Dockerfile 构建时候，会执行 test-build 的 Dockerfile 里的 ONBUILD 指定的命令。</p></li><li><p>LABLE：LABEL 指令用来给镜像添加一些元数据（metadata），以键值对的形式</p><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">格式：LABEL &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">比如我们可以添加镜像的作者：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">LABEL org.opencontainers.image.authors="runoob"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>DOCKER COMPOSE：Compose 是用于定义和运行多容器 Docker 应用程序的工具。通过 Compose，您可以使用 YML 文件来配置应用程序需要的所有服务。然后，使用一个命令，就可以从 YML 文件配置中创建并启动所有服务。</p></li></ul></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ideadocker">ideaDocker<a class="hash-link" href="#ideadocker" title="标题的直接链接">​</a></h4><blockquote><p>vim  /usr/lib/systemd/system/docker.service</p><p><img loading="lazy" alt="1667899914027" src="/assets/images/1667899914027-a2e0cc73c49f776222b41b6e087d3934.png" width="1045" height="306" class="img_ev3q"></p><p>-H tcp://0.0.0.0:2375  -H unix:///var/run/docker.sock</p><p>配置完成后，保存退出，然后重启 Docker：</p><p>systemctl daemon-reload    </p><p>service docker restart </p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nginx">nginx<a class="hash-link" href="#nginx" title="标题的直接链接">​</a></h2><blockquote><p><code>Nginx</code>是一个高性能的<code>http</code>和反向代理服务器，其特点是占用内存小，并发能力强。<code>Nginx</code>专为性能优化而开发，性能是其最重要的考量，能经受高负载的考验，有报告表明能支持高达50000个并发连接数。</p><p><img loading="lazy" alt="1668071825200" src="/assets/images/1668071825200-1227641bce62f6d8da0de75f75fc206a.png" width="931" height="449" class="img_ev3q"></p><ul><li><p>正向代理：在浏览器中配置代理服务器，通过代理服务器进行互联网访问。</p></li><li><p>反向代理：将请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，再返回给客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴漏的是代理服务器地址。</p></li><li><p>负载均衡：如果请求数过大，单个服务器解决不了，我们增加服务器的数量，然后将请求分发到各个服务器上，将原先请求集中到单个服务器的情况改为请求分发到多个服务器上，就是负载均衡。</p></li><li><p>为了加快服务器的解析速度，可以把动态页面和静态页面交给不同的服务器来解析，加快解析速度，降低原来单个服务器的压力。</p></li><li><p>安装：</p><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">安装pcre依赖</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">wget http://downloads.sourceforge.net/project/pcre/pcre/8.37/pcre-8.37.tar.gz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tar -xvf  pcre-8.37.tar.gz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">进入解压后的名录，执行以下命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">./configure</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">make &amp;&amp; make install</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">查看安装的pcre版本号</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pcre-config --version</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">安装openssl，zlib等依赖</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">yum -y install make zlib zlib-devel gcc-c++ libtool openssl openssl-devel</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nginx官网下载nginx，官网地址：https://nginx.org/download/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">将压缩包拖到服务器上;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">使用命令 tar -xvf nginx-1.12.2.tar.gz 解压压缩包;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">使用命令 ./configure 检查；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">使用命令 make &amp;&amp; make isntall 编译安装；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">安装openssl，zlib等依赖</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">yum -y install make zlib zlib-devel gcc-c++ libtool openssl openssl-devel</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-tel codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tel codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">nginx path prefix: /usr/local/nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nginx binary file: /usr/local/nginx/sbin/nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nginx configuration prefix: /usr/local/nginx/conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nginx configuration file: /usr/local/nginx/conf/nginx.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nginx pid file: /usr/local/nginx/logs/nginx.pid</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nginx error log file: /usr/local/nginx/logs/error.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nginx http access log file: /usr/local/nginx/logs/access.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">#user  nobody;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">worker_processes  1;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#error_log  logs/error.log;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#error_log  logs/error.log  notice;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#error_log  logs/error.log  info;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#pid        logs/nginx.pid;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">events {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    worker_connections  1024;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">http {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    include       mime.types;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    default_type  application/octet-stream;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #                  '$status $body_bytes_sent "$http_referer" '</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #                  '"$http_user_agent" "$http_x_forwarded_for"';</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #access_log  logs/access.log  main;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    sendfile        on;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #tcp_nopush     on;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #keepalive_timeout  0;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    keepalive_timeout  65;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #gzip  on;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    server {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        listen       80;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        server_name  localhost;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #charset koi8-r;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #access_log  logs/host.access.log  main;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        location / {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            root   html;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            index  index.html index.htm;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #error_page  404              /404.html;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        # redirect server error pages to the static page /50x.html</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        error_page   500 502 503 504  /50x.html;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        location = /50x.html {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            root   html;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #location ~ \.php$ {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #    proxy_pass   http://127.0.0.1;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #location ~ \.php$ {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #    root           html;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #    fastcgi_pass   127.0.0.1:9000;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #    fastcgi_index  index.php;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #    include        fastcgi_params;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        # deny access to .htaccess files, if Apache's document root</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        # concurs with nginx's one</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #location ~ /\.ht {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #    deny  all;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        #}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #server {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    listen       8000;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    listen       somename:8080;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    server_name  somename  alias  another.alias;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    location / {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #        root   html;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #        index  index.html index.htm;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # HTTPS server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #server {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    listen       443 ssl;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    server_name  localhost;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    ssl_certificate      cert.pem;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    ssl_certificate_key  cert.key;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    ssl_session_cache    shared:SSL:1m;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    ssl_session_timeout  5m;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    ssl_prefer_server_ciphers  on;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    location / {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #        root   html;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #        index  index.html index.htm;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></blockquote>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[设计模式]]></title>
            <link>https://keepli2420.github.io/blog/设计模式</link>
            <guid>/设计模式</guid>
            <pubDate>Tue, 21 Mar 2023 00:18:07 GMT</pubDate>
            <description><![CDATA[23种设计模式]]></description>
            <content:encoded><![CDATA[<p>23种设计模式</p><h1>设计模式简介</h1><blockquote><font color="Mahogany">设计模式是一套被反复使用的、经过分类编目的、代码设计经验的总结，使用设计模式是为了重用代码，让代码更容易被他人理解，保证代码的可靠性</font><font color="Mahogany">设计模式~Design~ ~pattern~代表了最佳实践，是软件开发人员在开发过程中面临的一般问题的解决方案</font><font color="CornflowerBlue">设计模式的分类：</font><ul><li><p>创建型模式：这些设计模式提供了一种在创建对象的同时隐藏创建逻辑的方式，而不是使用 new 运算符直接实例化对象。这使得程序在判断针对某个给定实例需要创建哪些对象时更加灵活。</p><ul><li><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"> 工厂模式（Factory Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  抽象工厂模式（Abstract Factory Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  单例模式（Singleton Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  建造者模式（Builder Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  原型模式（Prototype Pattern）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p>结构型模式：这些设计模式关注类和对象的组合。继承的概念被用来组合接口和定义组合对象获得新功能的方式。</p><ul><li><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  适配器模式（Adapter Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  桥接模式（Bridge Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  过滤器模式（Filter、Criteria Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  组合模式（Composite Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  装饰器模式（Decorator Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  外观模式（Facade Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  享元模式（Flyweight Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  代理模式（Proxy Pattern）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p>行为型模式：这些设计模式特别关注对象之间的通信。</p><ul><li><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  责任链模式（Chain of Responsibility Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  命令模式（Command Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  解释器模式（Interpreter Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  迭代器模式（Iterator Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  中介者模式（Mediator Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  备忘录模式（Memento Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  观察者模式（Observer Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  状态模式（State Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  空对象模式（Null Object Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  策略模式（Strategy Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  模板模式（Template Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  访问者模式（Visitor Pattern）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>J2EE 模式：这些设计模式特别关注表示层。这些模式是由 Sun Java Center 鉴定的。</p><ul><li><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">MVC 模式（MVC Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">业务代表模式（Business Delegate Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">组合实体模式（Composite Entity Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">数据访问对象模式（Data Access Object Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">前端控制器模式（Front Controller Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">拦截过滤器模式（Intercepting Filter Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">服务定位器模式（Service Locator Pattern）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">传输对象模式（Transfer Object Pattern）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><font color="CornflowerBlue">设计模式六大原则：</font><ul><li>开闭原则：（Open Close Principle）</li></ul><p>开闭原则的意思是：对外扩展开放，对内修改关闭。在程序需要进行拓展的时候，不能去修改原有的代码，实现一个热插拔的效果。简言之，是为了使程序的扩展性好，易于维护和升级。想要达到这样的效果，我们需要使用接口和抽象类，后面的具体设计中我们会提到这点。	</p><ul><li>里氏代换原则：（Liskov Substitution Principle）</li></ul><p>里氏代换原则是面向对象设计的基本原则之一。 里氏代换原则中说，任何基类可以出现的地方，子类一定可以出现。LSP 是继承复用的基石，只有当派生类可以替换掉基类，且软件单位的功能不受到影响时，基类才能真正被复用，而派生类也能够在基类的基础上增加新的行为。里氏代换原则是对开闭原则的补充。实现开闭原则的关键步骤就是抽象化，而基类与子类的继承关系就是抽象化的具体实现，所以里氏代换原则是对实现抽象化的具体步骤的规范。</p><ul><li>依赖倒转原则：（Dependence Inversion Principle）</li></ul><p>这个原则是开闭原则的基础，具体内容：针对接口编程，依赖于抽象而不依赖于具体</p><ul><li>接口隔离原则：（Interface Segregation Principle）</li></ul><p>这个原则的意思是：使用多个隔离的接口，比使用单个接口要好。它还有另外一个意思是：降低类之间的耦合度。由此可见，其实设计模式就是从大型软件架构出发、便于升级和维护的软件设计思想，它强调降低依赖，降低耦合。</p><ul><li>迪米特法则，又称最少知道原则（Demeter Principle）</li></ul><p>最少知道原则是指：一个实体类应当尽量少的与其他实体类之间发生相互作用，是的系统功能模块相对独立</p><ul><li>合成复用原则：（Composite Reuse Principle）</li></ul><p>合成复用原则是指：尽量使用合成/聚合的方式，而不是使用继承</p></blockquote><h1><font>工厂模式</font></h1><hr><blockquote><p>工厂模式（Factory Pattern）是 Java 中最常用的设计模式之一。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。在工厂模式中，我们在创建对象时不会对客户端暴露创建逻辑，并且是通过使用一个共同的接口来指向新创建的对象。</p><p><img loading="lazy" alt="1633688846949" src="/assets/images/1633688846949-053feedf4ce816ff729d85afe7bd46b8.png" width="969" height="782" class="img_ev3q"></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">#</span><span class="token class-name" style="color:rgb(38, 127, 153)">Shape</span><span class="token plain">接口</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Shape</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">draw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#</span><span class="token class-name" style="color:rgb(38, 127, 153)">Shape</span><span class="token plain">实现类，</span><span class="token class-name" style="color:rgb(38, 127, 153)">Rectangle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Rectangle</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Shape</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token annotation punctuation" style="color:rgb(4, 81, 165)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">draw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"Inside Rectangle::draw() method."</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#</span><span class="token class-name" style="color:rgb(38, 127, 153)">Shape</span><span class="token plain">实现类，</span><span class="token class-name" style="color:rgb(38, 127, 153)">Square</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Square</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Shape</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token annotation punctuation" style="color:rgb(4, 81, 165)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">draw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"Inside Square::draw() method."</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#</span><span class="token class-name" style="color:rgb(38, 127, 153)">Shape</span><span class="token plain">实现类，</span><span class="token class-name" style="color:rgb(38, 127, 153)">Circle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Circle</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Shape</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token annotation punctuation" style="color:rgb(4, 81, 165)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">draw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"Inside Circle::draw() method."</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#</span><span class="token class-name" style="color:rgb(38, 127, 153)">Shape</span><span class="token plain">工厂对象</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">ShapeFactory</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)">//使用 getShape 方法获取形状类型的对象</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Shape</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">getShape</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">String</span><span class="token plain"> shapeType</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">shapeType </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">shapeType</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">equalsIgnoreCase</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"CIRCLE"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Circle</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">shapeType</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">equalsIgnoreCase</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"RECTANGLE"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Rectangle</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">shapeType</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">equalsIgnoreCase</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"SQUARE"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Square</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">null</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#使用工厂对象，创建不同对象</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">FactoryPatternDemo</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">String</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token class-name" style="color:rgb(38, 127, 153)">ShapeFactory</span><span class="token plain"> shapeFactory </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">ShapeFactory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">//获取 Circle 的对象，并调用它的 draw 方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token class-name" style="color:rgb(38, 127, 153)">Shape</span><span class="token plain"> shape1 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> shapeFactory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">getShape</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"CIRCLE"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">//调用 Circle 的 draw 方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      shape1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">draw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">//获取 Rectangle 的对象，并调用它的 draw 方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token class-name" style="color:rgb(38, 127, 153)">Shape</span><span class="token plain"> shape2 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> shapeFactory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">getShape</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"RECTANGLE"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">//调用 Rectangle 的 draw 方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      shape2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">draw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">//获取 Square 的对象，并调用它的 draw 方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token class-name" style="color:rgb(38, 127, 153)">Shape</span><span class="token plain"> shape3 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> shapeFactory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">getShape</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"SQUARE"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)">//调用 Square 的 draw 方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      shape3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">draw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></blockquote><h1><font>抽象工厂模式</font></h1><hr><blockquote><p><img loading="lazy" alt="1633689236063" src="/assets/images/1633689236063-3b6abf000e3a375c06c0e71c0c428091.png" width="971" height="819" class="img_ev3q"></p><p><img loading="lazy" alt="1633689248776" src="/assets/images/1633689248776-e2950d9bfe490b5ecf8c6bde9ae0464b.png" width="948" height="644" class="img_ev3q"></p></blockquote><p><img loading="lazy" alt="1633684154618" src="/assets/images/1633684154618-ae5a4cb5469d81b867102c7248e082de.png" width="757" height="835" class="img_ev3q"></p><h1>Singleton</h1><blockquote><p>单例设计模式，保证程序中只有一个该实例</p></blockquote><ul><li><p>构造方法私有,饿汉式</p><p><img loading="lazy" alt="image-20220116175034799" src="/assets/images/image-20220116175034799-7babe40398fd8bba78254e114ff1ea1b.png" width="980" height="280" class="img_ev3q"></p></li><li><p>静态实例化，饿汉式</p></li></ul><p><img loading="lazy" alt="image-20220116180011928" src="/assets/images/image-20220116180011928-4fb1221b986c41d3b690be030dcacc25.png" width="876" height="315" class="img_ev3q"></p><ul><li><p>构造方法私有，懒汉式，线程安全，效率变低</p><p><img loading="lazy" alt="image-20220116180549918" src="/assets/images/image-20220116180549918-e484819d4f9d27405333cc3ee13854e6.png" width="1014" height="384" class="img_ev3q"></p></li><li><p>构造方法私有，懒汉式，双重判断</p><p><img loading="lazy" alt="image-20220117102228675" src="/assets/images/image-20220117102228675-bb628aa172341be66a5ea45578aa3a5d.png" width="868" height="422" class="img_ev3q"></p></li><li><p>内部类，懒汉式，线程安全，由jvm保证</p><p><img loading="lazy" alt="image-20220116183256506" src="/assets/images/image-20220116183256506-ec77577796145e44fbb4ecc164603590.png" width="1034" height="367" class="img_ev3q"></p></li><li><p>枚举单例</p><p><img loading="lazy" alt="image-20220116183845845" src="data:image/png;base64,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" width="714" height="130" class="img_ev3q"></p></li></ul><h1>责任链模式</h1><p><img loading="lazy" alt="image-20220118133616150" src="/assets/images/image-20220118133616150-d2421ef61de05eef073957903b589290.png" width="1808" height="449" class="img_ev3q"></p><p><img loading="lazy" alt="image-20220118133626834" src="/assets/images/image-20220118133626834-04b7c3c03c6913a1816df7bb21f22913.png" width="1767" height="667" class="img_ev3q"></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> </span><span class="token namespace">com</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">design</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">modes</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">chainofresponsibility</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">HTMLFilter</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Filter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(4, 81, 165)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">doFilter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">Request</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Response</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">FilterChina</span><span class="token plain"> filterChina</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"HTML后置处理1"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">str </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">replace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"&gt;"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"]"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">replace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"&lt;"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"["</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        filterChina</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">doFilter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"HTML后置处理1"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> </span><span class="token namespace">com</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">design</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">modes</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">chainofresponsibility</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">NumberFilter</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Filter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(4, 81, 165)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">doFilter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">Request</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Response</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">FilterChina</span><span class="token plain"> filterChina</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"Number后置处理2"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">str </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">replace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"123"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"xxx"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        filterChina</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">doFilter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"Number后置处理2"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> </span><span class="token namespace">com</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">design</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">modes</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">chainofresponsibility</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Main</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token class-name" style="color:rgb(38, 127, 153)">String</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name" style="color:rgb(38, 127, 153)">FilterChina</span><span class="token plain"> filterChina </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">FilterChina</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        filterChina</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">addFilter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">HTMLFilter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">addFilter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">NumberFilter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name" style="color:rgb(38, 127, 153)">Request</span><span class="token plain"> request </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">str </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"&lt;123123123&gt;"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name" style="color:rgb(38, 127, 153)">Response</span><span class="token plain"> response </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Response</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        filterChina</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">doFilter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token class-name" style="color:rgb(38, 127, 153)">System</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> </span><span class="token namespace">com</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">design</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">modes</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">chainofresponsibility</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Request</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token class-name" style="color:rgb(38, 127, 153)">String</span><span class="token plain"> str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> </span><span class="token namespace">com</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">design</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">modes</span><span class="token namespace punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token namespace">chainofresponsibility</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">Response</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token class-name" style="color:rgb(38, 127, 153)">String</span><span class="token plain"> str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Welcome]]></title>
            <link>https://keepli2420.github.io/blog/welcome</link>
            <guid>welcome</guid>
            <pubDate>Thu, 26 Aug 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Docusaurus blogging features are powered by the blog plugin.]]></description>
            <content:encoded><![CDATA[<p><a href="https://docusaurus.io/docs/blog" target="_blank" rel="noopener noreferrer">Docusaurus blogging features</a> are powered by the <a href="https://docusaurus.io/docs/api/plugins/@docusaurus/plugin-content-blog" target="_blank" rel="noopener noreferrer">blog plugin</a>.</p><p>Simply add Markdown files (or folders) to the <code>blog</code> directory.</p><p>Regular blog authors can be added to <code>authors.yml</code>.</p><p>The blog post date can be extracted from filenames, such as:</p><ul><li><code>2019-05-30-welcome.md</code></li><li><code>2019-05-30-welcome/index.md</code></li></ul><p>A blog post folder can be convenient to co-locate blog post images:</p><p><img loading="lazy" alt="Docusaurus Plushie" src="/assets/images/docusaurus-plushie-banner-a60f7593abca1e3eef26a9afa244e4fb.jpeg" width="1500" height="500" class="img_ev3q"></p><p>The blog supports tags as well!</p><p><strong>And if you don't want a blog</strong>: just delete this directory, and use <code>blog: false</code> in your Docusaurus config.</p>]]></content:encoded>
            <category>facebook</category>
            <category>hello</category>
            <category>docusaurus</category>
        </item>
        <item>
            <title><![CDATA[MDX Blog Post]]></title>
            <link>https://keepli2420.github.io/blog/mdx-blog-post</link>
            <guid>mdx-blog-post</guid>
            <pubDate>Sun, 01 Aug 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Blog posts support Docusaurus Markdown features, such as MDX.]]></description>
            <content:encoded><![CDATA[<p>Blog posts support <a href="https://docusaurus.io/docs/markdown-features" target="_blank" rel="noopener noreferrer">Docusaurus Markdown features</a>, such as <a href="https://mdxjs.com/" target="_blank" rel="noopener noreferrer">MDX</a>.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_S0QG"><p>Use the power of React to create interactive blog posts.</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">button onClick</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 0, 0)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">alert</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">'button clicked!'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token maybe-class-name">Click</span><span class="token plain"> me</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">button</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><button>Click me!</button></div></div>]]></content:encoded>
            <category>docusaurus</category>
        </item>
        <item>
            <title><![CDATA[Long Blog Post]]></title>
            <link>https://keepli2420.github.io/blog/long-blog-post</link>
            <guid>long-blog-post</guid>
            <pubDate>Wed, 29 May 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[This is the summary of a very long blog post,]]></description>
            <content:encoded><![CDATA[<p>This is the summary of a very long blog post,</p><p>Use a <code>&lt;!--</code> <code>truncate</code> <code>--&gt;</code> comment to limit blog post size in the list view.</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>]]></content:encoded>
            <category>hello</category>
            <category>docusaurus</category>
        </item>
        <item>
            <title><![CDATA[First Blog Post]]></title>
            <link>https://keepli2420.github.io/blog/first-blog-post</link>
            <guid>first-blog-post</guid>
            <pubDate>Tue, 28 May 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet]]></description>
            <content:encoded><![CDATA[<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>]]></content:encoded>
            <category>hola</category>
            <category>docusaurus</category>
        </item>
    </channel>
</rss>